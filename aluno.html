<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Benai Bernardo | Consultoria</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;800&family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>

    <style>
        :root {
            --primary: #001F5B; --primary-dark: #001640; 
            --accent: #00A8E8; --accent-dark: #007bb0;
            --bg: #fdfdfd; --surface: #ffffff;
            --text: #1f2937; --text-muted: #64748b;
            --border: #e2e8f0;
            
            --c-drop: #ef4444; --c-rnp: #f59e0b; --c-iso: #06b6d4; 
            --c-pyr: #8b5cf6; --c-fst: #ec4899; --c-bi: #00A8E8; --c-tri: #6366f1;
            --wa-green: #25D366;
            --font-ui: 'Plus Jakarta Sans', sans-serif; --font-num: 'Outfit', sans-serif;
        }

        [data-theme="dark"] {
            --primary: #bae6fd; --primary-dark: #7dd3fc;
            --accent: #38bdf8;
            --bg: #0f172a; --surface: #1e293b;
            --text: #f1f5f9; --text-muted: #94a3b8;
            --border: #334155;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: var(--font-ui); }
        body { background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; overflow: hidden; transition: background 0.3s; }

        .container { max-width: 480px; width: 100%; margin: 0 auto; display: flex; flex-direction: column; height: 100%; background: var(--bg); box-shadow: 0 0 20px rgba(0,0,0,0.05); }

        /* HEADER */
        .header { background: #001F5B; padding: 20px; flex-shrink: 0; border-bottom-left-radius: 24px; border-bottom-right-radius: 24px; box-shadow: 0 10px 30px -10px rgba(0,31,91,0.3); z-index: 10; display: flex; justify-content: space-between; align-items: flex-start; color: white; transition: background 0.3s; }
        [data-theme="dark"] .header { background: #1e293b; box-shadow: none; border-bottom: 1px solid var(--border); }

        .h-info { flex: 1; padding-right: 15px; }
        .h-brand { font-size: 0.65rem; letter-spacing: 2px; opacity: 0.8; text-transform: uppercase; margin-bottom: 4px; font-weight: 700; font-family: var(--font-num); color: var(--accent); }
        .h-sub-brand { font-size:0.5rem; letter-spacing:1px; opacity:0.8; margin-bottom:10px; font-weight:600; text-transform:uppercase; color:#bae6fd; }
        [data-theme="dark"] .h-sub-brand { color: #94a3b8; }

        .h-title { font-size: 1.6rem; font-weight: 800; font-family: var(--font-num); letter-spacing: -0.5px; line-height: 1.1; color: white; margin-bottom:2px; }
        .h-sub { opacity: 0.8; font-size: 0.85rem; color: #bae6fd; font-weight: 500; margin-bottom: 10px; }
        [data-theme="dark"] .h-sub { color: #94a3b8; }
        
        .h-dates { display: flex; gap: 8px; font-size: 0.65rem; font-weight: 700; color: white; opacity:0.9; }
        .h-date-badge { background: rgba(0,0,0,0.2); padding: 4px 8px; border-radius: 6px; display:flex; align-items:center; gap:4px; border:1px solid rgba(255,255,255,0.1); }
        .h-date-badge.urgent { background: rgba(239, 68, 68, 0.3); border-color: rgba(239, 68, 68, 0.5); color:#fca5a5; }
        
        .h-actions { display: flex; gap: 8px; align-items: center; }
        .h-btn { width: 40px; height: 40px; border-radius: 12px; border: none; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem; cursor: pointer; transition: 0.2s; background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2); text-decoration: none; }
        .h-btn:hover { background: rgba(255,255,255,0.25); }
        .btn-wa { background: rgba(37, 211, 102, 0.2); border-color: rgba(37, 211, 102, 0.4); color: #4ade80; }
        .btn-restore { display: none; }
        
        /* CONTENT */
        .content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; scroll-behavior: smooth; }
        .tab-pane { display: none; animation: fade 0.3s; }
        .tab-pane.active { display: block; }

        /* --- SOPHISTICATED TITLES --- */
        .modern-title {
            text-align: center;
            font-family: var(--font-num);
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 0.9rem;
            color: var(--primary);
            position: relative;
            display: flex; align-items: center; justify-content: center; gap: 15px;
            margin: 30px 0 20px;
            opacity: 0.8;
        }
        [data-theme="dark"] .modern-title { color: var(--accent); opacity: 1; }
        .modern-title::before, .modern-title::after {
            content: ''; height: 1px; background: var(--border); flex: 1;
        }

        /* --- BLOCOS (COLLAPSIBLE) --- */
        .section-header {
            display: flex; justify-content: space-between; align-items: center;
            cursor: pointer; padding: 15px 5px;
            border-bottom: 1px solid transparent;
            transition: 0.3s;
        }
        .section-header:hover { opacity: 0.8; }
        .section-title {
            color: var(--primary); font-family: var(--font-num); 
            font-weight: 800; text-transform: uppercase; letter-spacing: 1px; 
            font-size: 0.85rem; margin: 0; padding-left: 10px;
            border-left: 4px solid var(--accent);
        }
        [data-theme="dark"] .section-title { color: var(--text); }
        
        .toggle-icon { transition: transform 0.3s; color: var(--accent); }
        .is-closed .toggle-icon { transform: rotate(-90deg); }
        
        .block-content-area { transition: max-height 0.4s ease-in-out, opacity 0.4s; max-height: 3000px; opacity: 1; overflow: hidden; }
        .is-closed .block-content-area { max-height: 0; opacity: 0; }

        .biset-wrap { border: 2px dashed var(--c-bi); background: #f0f9ff; margin-bottom: 20px; border-radius: 16px; padding-top: 30px; position: relative; overflow: hidden; }
        [data-theme="dark"] .biset-wrap { background: rgba(0, 168, 232, 0.05); }
        .biset-lbl { position: absolute; top: 0; left: 0; background: var(--c-bi); color: white; font-size: 0.65rem; font-weight: 800; padding: 4px 12px; border-bottom-right-radius: 12px; }

        .triset-wrap { border: 2px dashed var(--c-tri); background: #fdf4ff; margin-bottom: 20px; border-radius: 16px; padding-top: 30px; position: relative; overflow: hidden; }
        [data-theme="dark"] .triset-wrap { background: rgba(99, 102, 241, 0.05); }
        .triset-lbl { position: absolute; top: 0; left: 0; background: var(--c-tri); color: white; font-size: 0.65rem; font-weight: 800; padding: 4px 12px; border-bottom-right-radius: 12px; }

        /* --- EXERC√çCIOS --- */
        .row { 
            padding: 15px; margin-bottom: 12px; 
            border: 1px solid var(--border); border-radius: 14px; 
            background: var(--surface); position: relative; border-left: 4px solid #cbd5e1; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.02); transition: 0.2s; 
        }
        .biset-wrap .row, .triset-wrap .row { margin-bottom: 0; border: none; border-radius: 0; box-shadow: none; border-left: 4px solid transparent; border-bottom: 1px dashed var(--border); background: transparent; }
        .biset-wrap .row:last-child, .triset-wrap .row:last-child { border-bottom: none; }

        .row.done { opacity: 0.5; filter: grayscale(100%); background: var(--bg) !important; border-left-color: var(--border) !important; }
        
        .row.m-Drop { border-left-color: var(--c-drop); background: #fef2f2; }
        .row.m-RNP { border-left-color: var(--c-rnp); background: #fff7ed; }
        .row.m-Iso { border-left-color: var(--c-iso); background: #ecfeff; }
        .row.m-Pyr { border-left-color: var(--c-pyr); background: #faf5ff; }
        .row.m-Normal { border-left-color: #cbd5e1; background: var(--surface); }

        [data-theme="dark"] .row.m-Drop { background: rgba(239, 68, 68, 0.1); }
        [data-theme="dark"] .row.m-RNP { background: rgba(245, 158, 11, 0.1); }
        [data-theme="dark"] .row.m-Iso { background: rgba(6, 182, 212, 0.1); }
        [data-theme="dark"] .row.m-Pyr { background: rgba(139, 92, 246, 0.1); }
        [data-theme="dark"] .row.m-Normal { background: var(--surface); }

        .m-tag { font-size: 0.55rem; font-weight: 800; color: white; padding: 3px 8px; border-radius: 6px; display: inline-block; margin-bottom: 6px; text-transform: uppercase; }
        .ex-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 8px; }
        
        .ex-title { font-size: 1rem; font-weight: 700; color: var(--text); line-height: 1.3; font-family: var(--font-num); text-decoration: none; flex: 1; display: inline-flex; align-items: center; gap: 8px; }
        .ex-title.has-video { color: var(--accent); }
        .yt-icon { color: #ef4444; font-size: 1.2rem; transition: transform 0.2s; filter: drop-shadow(0 2px 4px rgba(239, 68, 68, 0.2)); }
        .ex-title:active { opacity: 0.8; }

        .pills { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 12px; align-items: center; }
        .pill { background: rgba(255,255,255,0.7); padding: 5px 10px; border-radius: 8px; font-size: 0.8rem; font-weight: 700; color: #475569; border: 1px solid #e2e8f0; font-family: var(--font-num); }
        [data-theme="dark"] .pill { background: rgba(0,0,0,0.2); border-color: var(--border); color: var(--text-muted); }
        
        .pill.timer { margin-left: auto; border-color: var(--accent); color: var(--accent); background: rgba(0,168,232,0.05); cursor: pointer; display: flex; align-items: center; gap: 6px; }

        .obs { font-size: 0.8rem; color: #b45309; background: #fffbeb; padding: 10px; border-radius: 8px; margin-bottom: 12px; border-left: 3px solid #f59e0b; line-height: 1.4; word-wrap: break-word; }
        [data-theme="dark"] .obs { background: rgba(245, 158, 11, 0.1); color: #fbbf24; }

        .action-row { display: flex; gap: 10px; height: 42px; }
        .load-inp { width: 60px; border: 1px solid var(--border); border-radius: 10px; padding: 0 5px; font-family: var(--font-num); font-weight: 700; color: var(--text); text-align: center; font-size: 1rem; transition: 0.2s; background: var(--surface); }
        .load-inp:focus { border-color: var(--accent); outline: none; }
        .check-btn { flex: 1; border-radius: 10px; border: none; background: #e2e8f0; color: #64748b; font-weight: 800; font-size: 0.9rem; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: 0.2s; }
        [data-theme="dark"] .check-btn { background: #334155; color: #94a3b8; }
        .row.done .check-btn { background: var(--success); color: white; box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3); }

        /* Logic & Method Cards */
        .logic-card { background: var(--surface); border-radius: 16px; padding: 20px; border: 1px solid var(--border); margin-bottom: 25px; }
        
        .logic-item { display: flex; gap: 12px; margin-bottom: 12px; align-items: flex-start; }
        .logic-icon { min-width: 24px; height: 24px; background: #f1f5f9; color: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; margin-top: 2px; }
        [data-theme="dark"] .logic-icon { background: rgba(255,255,255,0.1); color:white; }
        .logic-text { color: var(--text-muted); font-size: 0.9rem; line-height: 1.5; font-weight: 500; }

        .method-grid { display: flex; flex-direction: column; gap: 12px; }
        .method-card { padding: 18px; border-radius: 14px; background: var(--surface); border: 1px solid rgba(0,0,0,0.05); position: relative; overflow: hidden; display: flex; gap: 15px; align-items: flex-start; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
        [data-theme="dark"] .method-card { border-color: var(--border); }
        .mc-icon { width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; color: white; flex-shrink: 0; margin-top: 2px; }
        .mc-content { flex: 1; }
        .mc-title { font-family: var(--font-num); font-weight: 800; font-size: 1rem; margin-bottom: 4px; color: var(--text); }
        .mc-text { font-size: 0.85rem; color: var(--text-muted); line-height: 1.5; }
        
        /* Subtle/Sophisticated Card Colors */
        .mc-danger { background: #f9fafb; border: 1px solid #e5e7eb; } .mc-danger .mc-icon { background: #e5e7eb; color: #64748b; }
        .mc-blue { background: #f9fafb; border: 1px solid #e5e7eb; } .mc-blue .mc-icon { background: #e5e7eb; color: #64748b; }
        [data-theme="dark"] .mc-danger { background: #1e293b; border-color: #334155; } [data-theme="dark"] .mc-danger .mc-icon { background: #334155; color: #94a3b8; }
        [data-theme="dark"] .mc-blue { background: #1e293b; border-color: #334155; } [data-theme="dark"] .mc-blue .mc-icon { background: #334155; color: #94a3b8; }

        /* Feedback */
        .feedback-box { background: var(--surface); border: 1px solid var(--border); border-radius: 24px; padding: 30px 20px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.05); }
        .fb-title { font-family: var(--font-num); font-weight: 800; font-size: 1.4rem; color: var(--primary); margin-bottom: 5px; }
        [data-theme="dark"] .fb-title { color: white; }
        .fb-sub { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 25px; }
        .stars { display: flex; justify-content: center; gap: 12px; margin-bottom: 25px; }
        .star { font-size: 2.2rem; color: var(--border); cursor: pointer; transition: 0.2s; }
        .star.filled { color: #f59e0b; transform: scale(1.1); filter: drop-shadow(0 2px 4px rgba(245, 158, 11, 0.3)); }
        .fb-area { width: 100%; border: 2px solid var(--border); border-radius: 16px; padding: 15px; font-family: var(--font-ui); margin-bottom: 15px; resize: none; font-size: 0.95rem; background: var(--bg); transition: 0.3s; color: var(--text); }
        .fb-area:focus { border-color: var(--accent); background: var(--surface); outline: none; }

        /* PSE SLIDER */
        .pse-container { margin: 20px 0; text-align: left; background: var(--bg); padding: 15px; border-radius: 16px; border: 1px solid var(--border); }
        .pse-label { font-size: 0.8rem; font-weight: 800; color: var(--text-muted); margin-bottom: 10px; display: flex; justify-content: space-between; }
        .pse-val { color: var(--accent); font-size: 1.2rem; }
        .pse-range { -webkit-appearance: none; width: 100%; height: 8px; background: var(--border); border-radius: 5px; outline: none; }
        .pse-range::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 24px; height: 24px; border-radius: 50%; background: var(--accent); cursor: pointer; border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        /* NAV */
        .nav { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 380px; height: 65px; background: var(--surface); border-radius: 35px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); display: flex; justify-content: space-around; align-items: center; z-index: 90; border: 1px solid rgba(0,0,0,0.05); padding: 0 10px; }
        [data-theme="dark"] .nav { border: 1px solid var(--border); box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .nav-btn { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; color: #cbd5e1; font-size: 0.65rem; font-weight: 700; cursor: pointer; transition: 0.2s; position: relative; }
        .nav-btn.active { color: var(--primary); transform: translateY(-3px); }
        [data-theme="dark"] .nav-btn.active { color: var(--accent); }
        .nav-btn.active::after { content: ''; width: 5px; height: 5px; background: var(--accent); border-radius: 50%; position: absolute; bottom: -6px; }
        .nav-btn i { font-size: 1.3rem; }

        /* TIMER */
        .timer-ov { position: fixed; inset: 0; background: rgba(0,31,91,0.95); z-index: 2000; display: none; flex-direction: column; align-items: center; justify-content: center; color: white; backdrop-filter: blur(5px); }
        [data-theme="dark"] .timer-ov { background: rgba(15, 23, 42, 0.95); }
        .t-disp { font-size: 5rem; font-weight: 900; font-family: var(--font-num); font-variant-numeric: tabular-nums; margin: 20px 0; }
        .t-row { display: flex; gap: 20px; }
        .t-btn { width: 70px; height: 70px; border-radius: 50%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; font-size: 1.1rem; cursor: pointer; font-weight: 700; transition: 0.2s; }
        .t-btn:active { transform: scale(0.9); background: white; color: var(--primary); }

        /* BLOCKED OVERLAY */
        #blocked-ov { position: fixed; inset: 0; background: #0f172a; z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 30px; text-align: center; }
        .btn-send-fb { background: var(--wa-green); color: white; border: none; padding: 18px; width: 100%; border-radius: 14px; font-weight: 800; font-size: 1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 8px 25px rgba(37, 211, 102, 0.3); transition: 0.2s; }
        
        /* Loading */
        .loading-state { text-align:center; padding:50px 20px; color:var(--text-muted); }
        .spin { animation: spin 1s linear infinite; font-size: 2rem; margin-bottom: 15px; color: var(--accent); }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        @keyframes fade { from{opacity:0} to{opacity:1} }
    </style>
</head>
<body>

<!-- BLOCKED SCREEN -->
<div id="blocked-ov">
    <i class="fa-solid fa-lock" style="font-size: 3rem; color: #ef4444; margin-bottom: 20px;"></i>
    <h2 style="color: white; font-size: 1.5rem; font-weight: 800; margin-bottom: 10px; font-family: var(--font-num);">Treino Expirado</h2>
    <p style="color: #94a3b8; margin-bottom: 30px; font-size: 0.9rem;">O per√≠odo do seu acompanhamento encerrou. Renove para continuar evoluindo.</p>
    <a href="https://wa.me/5541997222664?text=Oi%20Benai,%20quero%20renovar%20a%20consultoria!" class="btn-send-fb" style="text-decoration:none;">
        <i class="fa-brands fa-whatsapp"></i> RENOVAR PLANO
    </a>
</div>

<div class="container">
    <div class="header">
        <div class="h-info">
            <div class="h-brand" id="secretTrigger" onclick="toggleAdmin()">BENAI BERNARDO</div>
            <div class="h-sub-brand">CONSULTORIA DE TREINAMENTO</div>
            <div class="h-title" id="sName">Ol√°!</div>
            <div class="h-sub" id="sFocus">Carregando...</div>
            <div class="h-dates">
                <div class="h-date-badge" id="date-start-badge"><i class="fa-solid fa-calendar"></i> In√≠cio: <span id="val-start">--/--</span></div>
                <div class="h-date-badge" id="date-end-badge"><i class="fa-solid fa-hourglass-half"></i> Vence: <span id="val-end">--/--</span></div>
            </div>
        </div>
        <div class="h-actions">
            <a href="https://wa.me/5541997222664" target="_blank" class="h-btn btn-wa" title="Falar com Benai">
                <i class="fa-brands fa-whatsapp"></i>
            </a>
            <button class="h-btn" onclick="toggleTheme()" title="Modo Escuro/Claro">
                <i class="fa-solid fa-moon" id="theme-icon"></i>
            </button>
            <button id="adminBtn" class="h-btn btn-restore" onclick="adminTriggerRestore()" title="Ver Relat√≥rio do Aluno">
                <i class="fa-solid fa-cloud-arrow-up"></i>
            </button>
            <input type="file" id="adminRestoreFile" hidden onchange="adminLoadFile(this)">
        </div>
    </div>

    <div id="tab-1" class="tab-pane active content">
        <div id="wList">
            <div class="loading-state">
                <i class="fa-solid fa-circle-notch spin"></i>
                <div>Buscando seu treino...</div>
            </div>
        </div>
        <div style="height: 20px;"></div>
    </div>

    <div id="tab-2" class="tab-pane content">
        <div style="margin-bottom:30px;">
            <div class="modern-title"><i class="fa-solid fa-bullseye"></i> L√≥gica do Treino</div>
            <div class="logic-card" id="logicTopics"></div>
        </div>
        
        <div>
            <div class="modern-title"><i class="fa-solid fa-layer-group"></i> Pilares do M√©todo</div>
            <div id="pillarsContainer" class="method-grid">
                <!-- PILLARS RENDERED VIA JS -->
            </div>
        </div>
    </div>

    <div id="tab-3" class="tab-pane content">
        <div class="feedback-box">
            <i class="fa-solid fa-quote-left" style="font-size:2rem; color:var(--border); margin-bottom:15px;"></i>
            <div class="fb-title">Avalie a Consultoria</div>
            <div class="fb-sub">Sua evolu√ß√£o e satisfa√ß√£o s√£o meu foco.</div>
            
            <div class="stars">
                <i class="fa-solid fa-star star" onclick="rate(1)"></i>
                <i class="fa-solid fa-star star" onclick="rate(2)"></i>
                <i class="fa-solid fa-star star" onclick="rate(3)"></i>
                <i class="fa-solid fa-star star" onclick="rate(4)"></i>
                <i class="fa-solid fa-star star" onclick="rate(5)"></i>
            </div>

            <div class="pse-container">
                <div class="pse-label">
                    <span>N√çVEL DE ESFOR√áO (PSE)</span>
                    <span class="pse-val" id="pseVal">8</span>
                </div>
                <input type="range" min="1" max="10" value="8" class="pse-range" id="pseInput" oninput="document.getElementById('pseVal').innerText=this.value">
                <div style="display:flex; justify-content:space-between; font-size:0.65rem; color:var(--text-muted); margin-top:5px; font-weight:700;">
                    <span>LEVE</span><span>MODERADO</span><span>EXAUST√ÉO</span>
                </div>
            </div>

            <textarea id="fbComment" class="fb-area" rows="4" placeholder="Como est√° se sentindo com o acompanhamento? O que melhorou na sua rotina/corpo?"></textarea>
            <button class="btn-send-fb" onclick="sendWhatsAppFeedback()"><i class="fa-brands fa-whatsapp"></i> ENVIAR NO WHATSAPP</button>
        </div>
    </div>
</div>

<div class="nav">
    <div class="nav-btn active" onclick="go(1)"><i class="fa-solid fa-dumbbell"></i> TREINO</div>
    <div class="nav-btn" onclick="go(2)"><i class="fa-solid fa-book-open"></i> M√âTODO</div>
    <div class="nav-btn" onclick="go(3)"><i class="fa-solid fa-star"></i> FEEDBACK</div>
</div>

<div id="timer" class="timer-ov">
    <div style="font-weight:700; letter-spacing:3px; opacity:0.7;">DESCANSO</div>
    <div class="t-disp" id="tDisp">00:00</div>
    <div class="t-row"><button class="t-btn" onclick="addT(-10)">-10</button><button class="t-btn" onclick="addT(10)">+10</button></div>
    <button onclick="closeT()" style="margin-top:40px; background:white; color:var(--primary); border:none; padding:12px 40px; border-radius:30px; font-weight:800; font-size:1rem;">VOLTAR</button>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        initTheme();
        init();
    });
    
    let tmr, sec=0, currentData=null, rating=5, adminClicks=0;

    const PILLARS = {
        'Muscula√ß√£o': [
            {t:"1. Dor Boa vs. Dor Ruim", d:"Queima√ß√£o muscular √© sinal verde (evolu√ß√£o). Pontada aguda na articula√ß√£o √© SINAL VERMELHO. Pare e ajuste.", i:"triangle-exclamation", c:"danger"},
            {t:"2. N√£o vire um Baiacu", d:"N√£o prenda o ar ficando roxo! Solte o ar (assopre a vela) quando fizer a for√ßa. Oxig√™nio √© energia.", i:"wind", c:"blue"},
            {t:"3. Postura de Super-her√≥i", d:"Estufe o peito e trave o abd√¥men (como se fosse levar um soco). Essa armadura protege sua coluna.", i:"shield-halved", c:"purple"},
            {t:"4. Quem manda √© voc√™", d:"N√£o deixe o peso despencar. Des√ßa em c√¢mera lenta (3 seg) e suba com explos√£o. Domine a carga.", i:"stopwatch", c:"cyan"},
            {t:"5. O Descanso √© Sagrado", d:"Respeite o timer. Menos descanso atrapalha a for√ßa, mais descanso esfria o corpo. Foco total.", i:"hourglass-half", c:"orange"},
            {t:"6. Intensidade de Verdade", d:"Se terminou a s√©rie mexendo no celular, estava leve. O treino bom √© aquele que a gente faz careta no final.", i:"gauge-high", c:"green"}
        ],
        'Calistenia': [
            {t:"1. Dor vs. Desconforto", d:"O corpo vai tremer, √© normal. Mas fisgada no ombro ou cotovelo n√£o √©. Suas articula√ß√µes s√£o ouro, cuide delas.", i:"triangle-exclamation", c:"danger"},
            {t:"2. Corpo de Pedra (Tens√£o)", d:"Contraia tudo! Bumbum duro, ponta de p√© esticada, barriga travada. Quanto mais r√≠gido, mais leve voc√™ fica.", i:"link", c:"purple"},
            {t:"3. Amplitude √© Rei", d:"Estique o bra√ßo todo! Encoste o peito no ch√£o! Meia repeti√ß√£o d√° meio resultado. Busque a perfei√ß√£o.", i:"maximize", c:"cyan"},
            {t:"4. Ombros Longe da Orelha", d:"N√£o deixe os ombros subirem. Empurre o ch√£o com vontade e mantenha as costas firmes.", i:"bone", c:"orange"},
            {t:"5. Controle a Negativa", d:"A gravidade n√£o pode te vencer. Segure a volta do movimento. √â isso que te prepara para movimentos avan√ßados.", i:"arrow-down", c:"green"},
            {t:"6. Qualidade > Quantidade", d:"5 barras perfeitas valem mais que 20 barras 'minhoquinha'. Se a forma quebrou, a s√©rie acabou.", i:"award", c:"blue"}
        ]
    };

    function initTheme() {
        const theme = localStorage.getItem('theme');
        if(theme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.getElementById('theme-icon').className = 'fa-solid fa-sun';
        }
    }

    function toggleTheme() {
        const root = document.documentElement;
        const icon = document.getElementById('theme-icon');
        if(root.hasAttribute('data-theme')) {
            root.removeAttribute('data-theme');
            localStorage.setItem('theme', 'light');
            icon.className = 'fa-solid fa-moon';
        } else {
            root.setAttribute('data-theme', 'dark');
            localStorage.setItem('theme', 'dark');
            icon.className = 'fa-solid fa-sun';
        }
    }

    async function init() {
        const p = new URLSearchParams(window.location.search);
        const id = p.get('id');
        const dataOld = p.get('data'); 

        if(id) {
            try {
                const req = await fetch(`https://api.github.com/gists/${id}`);
                if(!req.ok) throw new Error("Treino n√£o encontrado");
                
                const json = await req.json();
                const content = json.files["treino.json"].content;
                currentData = JSON.parse(content);
                
                localStorage.setItem('cached_workout', JSON.stringify(currentData));

                processData(currentData);
            } catch(e) {
                const cached = localStorage.getItem('cached_workout');
                if(cached) {
                    currentData = JSON.parse(cached);
                    processData(currentData, true);
                } else {
                    document.getElementById('wList').innerHTML = `<div style="text-align:center; padding:40px; color:#ef4444;"><i class="fa-solid fa-triangle-exclamation" style="font-size:2rem;margin-bottom:10px;"></i><br>Erro ao baixar treino.<br><small>Sem internet e sem cache.</small></div>`;
                }
            }
        } else if (dataOld) {
            try {
                const json = LZString.decompressFromEncodedURIComponent(dataOld);
                currentData = JSON.parse(json);
                processData(currentData);
            } catch(e) { alert("Link antigo corrompido."); }
        } else {
            const cached = localStorage.getItem('cached_workout');
            if(cached) {
                currentData = JSON.parse(cached);
                processData(currentData);
            } else {
                document.getElementById('wList').innerHTML = '<div style="text-align:center; padding:40px; color:#9ca3af;">Nenhum treino encontrado.</div>';
            }
        }
    }

    function processData(data, isOffline = false) {
        // Handle Dates Display
        const formatDate = (isoStr) => {
            if(!isoStr) return '--/--';
            const parts = isoStr.split('-');
            return `${parts[2]}/${parts[1]}`;
        }

        const start = formatDate(data.startDate);
        const end = formatDate(data.expiryDate);
        
        document.getElementById('val-start').innerText = start;
        document.getElementById('val-end').innerText = end;

        if(data.expiryDate) {
            const now = new Date();
            const exp = new Date(data.expiryDate);
            const diffTime = exp - now;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            const badge = document.getElementById('date-end-badge');
            if(diffTime < 0) {
                document.getElementById('blocked-ov').style.display = 'flex';
                return;
            } else if(diffDays <= 7) {
                badge.classList.add('urgent');
            }
        }

        render(data);
        restoreSession(); 
        rate(5);
        
        if(isOffline) {
            const list = document.getElementById('wList');
            const warning = document.createElement('div');
            warning.innerHTML = '<div style="background:#fefce8; color:#854d0e; padding:10px; text-align:center; font-size:12px; font-weight:bold; border-bottom:1px solid #fef9c3;">Modo Offline (√öltima vers√£o salva)</div>';
            list.prepend(warning);
        }
    }

    function render(data) {
        document.getElementById('sName').innerText = `Ol√°, ${data.name.split(' ')[0]}!`;
        document.getElementById('sFocus').innerText = data.focus;
        
        // LOGIC RENDERING
        const logicContainer = document.getElementById('logicTopics');
        logicContainer.innerHTML = '';
        let topics = [];
        if(typeof data.logic === 'string') topics = data.logic.split('\n').filter(t => t.trim() !== '');
        else if(Array.isArray(data.logic)) topics = data.logic;
        
        if(topics.length === 0) topics = ["Foco na execu√ß√£o."];
        
        topics.forEach(topic => { 
            logicContainer.innerHTML += `<div class="logic-item"><div class="logic-icon"><i class="fa-solid fa-check"></i></div><div class="logic-text">${topic}</div></div>`; 
        });

        // PILLARS RENDERING
        const methodology = data.methodology || 'Muscula√ß√£o';
        const pillars = PILLARS[methodology] || PILLARS['Muscula√ß√£o'];
        const pCont = document.getElementById('pillarsContainer');
        pCont.innerHTML = '';
        pillars.forEach(p => {
            pCont.innerHTML += `
            <div class="method-card mc-${p.c || 'blue'}">
                <div class="mc-icon"><i class="fa-solid fa-${p.i || 'star'}"></i></div>
                <div class="mc-content">
                    <div class="mc-title">${p.t}</div>
                    <div class="mc-text">${p.d}</div>
                </div>
            </div>`;
        });

        const list = document.getElementById('wList');
        const warning = list.querySelector('div[style*="background:#fefce8"]');
        list.innerHTML = ''; 
        if(warning) list.appendChild(warning);
        
        if(data.blocks) {
            data.blocks.forEach((b, bIdx) => {
                let itemsHtml = '';
                b.items.forEach((item, iIdx) => {
                    let showTimer = true;
                    if(b.type === 'biset' || b.type === 'triset') {
                        if(iIdx < b.items.length - 1) showTimer = false;
                    }
                    itemsHtml += mkRow(bIdx, iIdx, item, showTimer);
                });
                
                let wrapper = '';
                // Collapsible logic wrapper
                const collapseId = `block-${bIdx}`;
                
                // Add specific header for collapsible behavior
                const header = `<div class="section-header" onclick="toggleBlock('${collapseId}')">
                    <h3 class="section-title">${b.name}</h3>
                    <i class="fas fa-chevron-down toggle-icon"></i>
                </div>`;

                if(b.type === 'biset') wrapper = `<div class="biset-wrap">${header}<div class="biset-lbl">BI-SET</div><div id="${collapseId}" class="block-content-area">${itemsHtml}</div></div>`;
                else if(b.type === 'triset') wrapper = `<div class="triset-wrap">${header}<div class="triset-lbl">TRI-SET</div><div id="${collapseId}" class="block-content-area">${itemsHtml}</div></div>`;
                else wrapper = `<div class="normal-wrap">${header}<div id="${collapseId}" class="block-content-area">${itemsHtml}</div></div>`; 

                list.innerHTML += wrapper;
            });
        }
    }

    function toggleBlock(id) {
        const content = document.getElementById(id);
        const parent = content.parentElement;
        parent.classList.toggle('is-closed');
    }

    function mkRow(bIdx, iIdx, item, showTimer = true) {
        const uid = `${bIdx}-${iIdx}`;
        const rest = parseInt(item.rest) || 60;
        
        let methodClass = 'm-Normal', tag = '';
        const m = (item.method || 'normal').toLowerCase();

        if(m === 'drop') { methodClass = 'm-Drop'; tag = '<span class="m-tag" style="background:var(--c-drop)">DROP-SET</span>'; }
        if(m === 'rnp' || m === 'rest') { methodClass = 'm-RNP'; tag = '<span class="m-tag" style="background:var(--c-rnp)">REST-PAUSE</span>'; }
        if(m === 'iso') { methodClass = 'm-Iso'; tag = '<span class="m-tag" style="background:var(--c-iso)">ISOMETRIA</span>'; }
        if(m === 'pyr') { methodClass = 'm-Pyr'; tag = '<span class="m-tag" style="background:var(--c-pyr)">PIR√ÇMIDE</span>'; }
        if(m === 'fst7') { methodClass = 'm-FST7'; tag = '<span class="m-tag" style="background:var(--c-fst)">FST-7</span>'; }

        let titleHtml = '';
        if(item.link && item.link.length > 5) {
            titleHtml = `<a href="${item.link}" target="_blank" class="ex-title has-video">${item.name} <i class="fa-solid fa-circle-play yt-icon"></i></a>`;
        } else {
            titleHtml = `<span class="ex-title">${item.name}</span>`;
        }

        let sL="Sets", rL="Reps";
        if(m === 'drop') { sL="Sets"; rL="R.Max"; }
        if(m === 'iso') { rL="Iso"; }
        if(m === 'pyr') { rL="Reps"; }

        let pillsHtml = `<span class="pill">${item.sets} ${sL}</span>`;
        
        if(m === 'iso') {
            pillsHtml += `<span class="pill">${item.isoReps || 1}x</span>`;
            pillsHtml += `<span class="pill mv-iso">${item.reps}s Iso</span>`;
        } else {
            pillsHtml += `<span class="pill">${item.reps} ${rL}</span>`;
            if(m === 'drop' && item.drops) pillsHtml += `<span class="pill" style="color:var(--c-drop); border-color:var(--c-drop); background:white;">+${item.drops} Drops</span>`;
            if((m === 'rnp' || m === 'rest')) {
                 let t = item.rnpRest || '10'; 
                 pillsHtml += `<span class="pill" style="color:var(--c-rnp); border-color:var(--c-rnp); background:white;">+${t}s Pausa</span><span class="pill" style="color:var(--c-rnp); border-color:var(--c-rnp); background:white;">+ Falha</span>`;
            }
        }

        if(showTimer) pillsHtml += `<span class="pill timer" onclick="openT(${rest})"><i class="fa-solid fa-stopwatch"></i> ${item.rest} <i class="fa-solid fa-hand-pointer" style="font-size:0.6rem; opacity:0.5"></i></span>`;

        return `
            <div class="row ${methodClass}" id="r-${uid}" data-name="${item.name}">
                ${tag} <div class="ex-header">${titleHtml}</div>
                <div class="pills">${pillsHtml}</div>
                ${item.obs ? `<div class="obs">‚ö†Ô∏è ${item.obs}</div>` : ''}
                <div class="action-row">
                    <input type="number" id="load-${uid}" class="load-inp" placeholder="kg" onchange="saveLoad('${uid}', this.value)">
                    <button class="check-btn" onclick="toggle('${uid}')"><i class="fa-solid fa-check-circle"></i> FEITO</button>
                </div>
            </div>
        `;
    }

    function toggle(uid) { const r=document.getElementById('r-'+uid); if(r.classList.contains('done')){r.classList.remove('done');localStorage.removeItem('chk_'+uid);}else{r.classList.add('done');localStorage.setItem('chk_'+uid,'1');if(navigator.vibrate)navigator.vibrate(50);} }
    function saveLoad(uid,v) { localStorage.setItem('load_'+uid,v); }
    function restoreSession() { document.querySelectorAll('.row').forEach(r=>{const uid=r.id.replace('r-','');if(localStorage.getItem('chk_'+uid))r.classList.add('done');const l=localStorage.getItem('load_'+uid);if(l)document.getElementById('load-'+uid).value=l;}); }
    function go(n) { document.querySelectorAll('.tab-pane').forEach(e=>e.classList.remove('active'));document.querySelectorAll('.nav-btn').forEach(e=>e.classList.remove('active'));document.getElementById('tab-'+n).classList.add('active');document.querySelectorAll('.nav-btn')[n-1].classList.add('active');window.scrollTo(0,0); }
    function openT(s) { sec=s;updT();document.getElementById('timer').style.display='flex';if(tmr)clearInterval(tmr);tmr=setInterval(()=>{sec--;updT();if(sec<=0){clearInterval(tmr);navigator.vibrate([200,100,200]);}},1000); }
    function addT(v){sec+=v;updT();} function closeT(){document.getElementById('timer').style.display='none';clearInterval(tmr);} function updT(){let m=Math.floor(sec/60),s=sec%60;if(sec<0){m=0;s=0;}document.getElementById('tDisp').innerText=`${m}:${s<10?'0'+s:s}`;}
    
    // ADMIN RESTORE (Secreto: toque 5x no titulo "Benai App" no header)
    function toggleAdmin(){adminClicks++;if(adminClicks>=5){document.getElementById('adminBtn').style.display='flex';alert("Modo Admin Ativado");adminClicks=0;}}
    
    function rate(n){rating=n;document.querySelectorAll('.star').forEach((s,i)=>{if(i<n)s.classList.add('filled');else s.classList.remove('filled');});}
    
    function sendWhatsAppFeedback() {
        if(!currentData) return alert("Erro: Treino n√£o carregado.");
        const c = document.getElementById('fbComment').value;
        const pse = document.getElementById('pseInput').value;
        const n = currentData.name || "Aluno";
        
        const msg = `*Feedback Consultoria Benai*\n\nüë§ Aluno: ${n}\n‚≠ê Nota: ${rating}/5\nüî• Esfor√ßo (PSE): ${pse}/10\nüí¨ Coment√°rio: ${c || 'Sem coment√°rio.'}\n\n_Enviado via Benai App_`;
        
        // WhatsApp URL
        const url = `https://wa.me/5541997222664?text=${encodeURIComponent(msg)}`;
        window.open(url, '_blank');
    }
    
    function adminTriggerRestore(){document.getElementById('adminRestoreFile').click();}
    function adminLoadFile(i){const f=i.files[0];if(!f)return;const r=new FileReader();r.onload=e=>{try{const j=JSON.parse(e.target.result);if(j.data){Object.keys(j.data).forEach(u=>{const it=j.data[u],r=document.getElementById('r-'+u);if(r){if(it.done)r.classList.add('done');if(it.load)document.getElementById('load-'+u).value=it.load;}});if(j.feedback)alert(`üìù NOTA: ${j.feedback.rating}/5\n"${j.feedback.comment}"`);else alert("Dados restaurados!");}}catch(x){alert("Erro ao ler arquivo.");}};r.readAsText(f);}
</script>
</body>
</html>
