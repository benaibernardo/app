<!DOCTYPE html>
<html lang="pt-br" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Benai Tracker | Planner</title>
    
    <!-- LIBS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;800&family=Space+Grotesk:wght@300;400;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Outfit', 'sans-serif'], mono: ['Space Grotesk', 'monospace'] },
                    colors: { 
                        brand: { bg: '#0b1121', surface: '#1e293b', accent: '#0ea5e9' } 
                    }
                }
            }
        }
    </script>

    <style>
        /* BASE THEMES */
        body { background-color: #f8fafc; color: #1e293b; transition: background-color 0.3s, color 0.3s; overflow-x: hidden; }
        html.dark body { background-color: #0b1121; color: #e2e8f0; }
        
        /* BACKGROUND */
        .orb { position: fixed; border-radius: 50%; filter: blur(100px); z-index: -1; opacity: 0.4; pointer-events: none; }

        /* GLASS */
        .glass-panel {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
        }
        html.dark .glass-panel {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: none;
        }
        
        /* TIMELINE */
        .date-card { transition: all 0.3s; position: relative; overflow: hidden; }
        .date-card.active { background: #0ea5e9 !important; color: white !important; border-color: #0ea5e9 !important; box-shadow: 0 0 15px rgba(14, 165, 233, 0.4); transform: translateY(-2px); }
        .date-card.today::after { content: ''; position: absolute; bottom: 4px; width: 4px; height: 4px; background: currentColor; border-radius: 50%; }
        
        /* TASKS */
        .task-item { transition: all 0.2s; border-left: 4px solid transparent; position: relative; }
        .task-item:hover { transform: translateX(2px); }
        .task-done { opacity: 0.5; text-decoration: line-through; filter: grayscale(1); }
        html.dark .task-done { background: rgba(30, 41, 59, 0.3) !important; border-color: #64748b !important; }
        html:not(.dark) .task-done { background: #f1f5f9 !important; border-color: #cbd5e1 !important; }
        
        /* PRIORITIES VISUALS */
        .prio-high { border-left-color: #ef4444; }
        html.dark .prio-high { background: linear-gradient(90deg, rgba(239,68,68,0.15) 0%, rgba(30,41,59,0.6) 100%); }
        html:not(.dark) .prio-high { background: linear-gradient(90deg, rgba(239,68,68,0.1) 0%, rgba(255,255,255,0.8) 100%); }

        .prio-med { border-left-color: #f59e0b; }
        html.dark .prio-med { background: linear-gradient(90deg, rgba(245,158,11,0.1) 0%, rgba(30,41,59,0.6) 100%); }
        html:not(.dark) .prio-med { background: linear-gradient(90deg, rgba(245,158,11,0.1) 0%, rgba(255,255,255,0.8) 100%); }

        .prio-low { border-left-color: #3b82f6; }
        html.dark .prio-low { background: rgba(30, 41, 59, 0.6); }
        html:not(.dark) .prio-low { background: rgba(255, 255, 255, 0.8); }

        /* SHOPPING VISUALS */
        .shop-item { border-left: 4px solid #f59e0b; }
        html.dark .shop-item { background: rgba(30, 41, 59, 0.6); }
        html:not(.dark) .shop-item { background: rgba(255, 255, 255, 0.8); }

        /* GOALS PROGRESS */
        .progress-bar-bg { background: rgba(0,0,0,0.1); border-radius: 99px; overflow: hidden; height: 6px; }
        html.dark .progress-bar-bg { background: rgba(255,255,255,0.1); }
        .progress-bar-fill { height: 100%; border-radius: 99px; transition: width 1s ease-in-out; }
        
        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        html.dark ::-webkit-scrollbar-thumb { background: #334155; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* FAB */
        .fab {
            position: fixed; bottom: 2rem; right: 2rem;
            width: 3.5rem; height: 3.5rem;
            background: #0ea5e9; color: white;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 10px 25px -5px rgba(14, 165, 233, 0.5);
            transition: all 0.3s; z-index: 50;
        }
        .fab:hover { transform: scale(1.1) rotate(90deg); }
        .fab:active { transform: scale(0.9); }

        /* ANIMATIONS */
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    </style>
</head>
<body class="min-h-screen pb-24">

    <!-- BACKGROUND -->
    <div class="orb w-96 h-96 bg-blue-300/30 dark:bg-blue-600/20 top-0 left-0"></div>
    <div class="orb w-96 h-96 bg-emerald-300/30 dark:bg-emerald-600/20 bottom-0 right-0"></div>

    <!-- GATEKEEPER -->
    <div id="gatekeeper" class="fixed inset-0 z-[9999] flex flex-col items-center justify-center bg-slate-50 dark:bg-[#0b1121] transition-all duration-500">
        <div class="text-center space-y-6">
            <i data-lucide="lock" class="w-12 h-12 text-sky-500 mx-auto"></i>
            <h1 class="text-2xl font-mono font-bold text-slate-900 dark:text-white">BENAI TRACKER</h1>
            <input type="password" id="pinInput" maxlength="8" class="bg-transparent border-b-2 border-slate-300 dark:border-slate-700 text-center text-3xl tracking-[1rem] w-64 focus:outline-none focus:border-sky-500 font-mono text-slate-900 dark:text-white" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
    </div>

    <!-- APP CONTENT -->
    <div id="app" class="opacity-0 transition-opacity duration-700 max-w-5xl mx-auto px-4 py-6">
        
        <!-- HEADER -->
        <header class="flex justify-between items-center mb-6">
            <!-- VOLTAR PARA INDEX.HTML -->
            <button onclick="window.location.href='index.html'" class="p-2 rounded-xl hover:bg-slate-200 dark:hover:bg-white/5 text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition">
                <i data-lucide="arrow-left" class="w-6 h-6"></i>
            </button>
            <div class="text-center flex flex-col items-center">
                <h1 class="font-bold text-xl tracking-wide text-slate-900 dark:text-white">TRACKER</h1>
                <div class="flex items-center gap-2 mt-1">
                    <p id="headerDate" class="text-[10px] text-sky-500 dark:text-sky-400 uppercase tracking-widest font-mono">Carregando...</p>
                    <div class="relative group">
                        <i data-lucide="calendar-search" class="w-4 h-4 text-slate-400 dark:text-slate-500 cursor-pointer hover:text-sky-500 transition"></i>
                        <input type="date" id="historyPicker" class="absolute inset-0 opacity-0 cursor-pointer w-full h-full" onchange="changeDate(this.value)">
                    </div>
                </div>
            </div>
            <div class="flex gap-2">
                <!-- BOT√ÉO DE TEMA -->
                <button onclick="toggleTheme()" class="p-2 rounded-xl hover:bg-slate-200 dark:hover:bg-white/5 text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition">
                    <i id="themeIcon" data-lucide="moon" class="w-6 h-6"></i>
                </button>
                <button onclick="openSyncModal()" class="p-2 rounded-xl hover:bg-slate-200 dark:hover:bg-white/5 relative group">
                    <div id="syncDot" class="absolute top-2 right-2 w-2 h-2 rounded-full bg-slate-400 dark:bg-slate-500 border border-white dark:border-[#0b1121]"></div>
                    <i data-lucide="cloud" class="w-6 h-6 text-slate-500 dark:text-slate-400 group-hover:text-slate-900 dark:group-hover:text-white transition"></i>
                </button>
            </div>
        </header>

        <!-- TIMELINE -->
        <div class="flex justify-between gap-2 overflow-x-auto pb-2 mb-4 no-scrollbar" id="timelineContainer">
            <!-- Injected by JS (Mon-Sun) -->
        </div>

        <!-- GOALS SECTION -->
        <div class="mb-8">
            <div class="flex justify-between items-end mb-3 px-1">
                <h2 class="text-sm font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider flex items-center gap-2">
                    <i data-lucide="target" class="w-4 h-4 text-pink-500"></i> Metas & Objetivos
                </h2>
                <button onclick="openModal('create', 'goal')" class="text-[10px] text-pink-500 hover:text-pink-600 dark:text-pink-400 dark:hover:text-white font-bold bg-pink-500/10 px-2 py-1 rounded-lg border border-pink-500/20 transition">+ Nova Meta</button>
            </div>
            <div id="goalsContainer" class="flex gap-4 overflow-x-auto pb-4 snap-x">
                <!-- Goals injected here -->
            </div>
        </div>

        <!-- BENTO GRID -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            
            <!-- AGENDA -->
            <div class="glass-panel rounded-3xl p-5 flex flex-col h-[400px] md:h-auto md:row-span-2 relative overflow-hidden group">
                <div class="flex justify-between items-center mb-4 z-10">
                    <h2 class="font-bold flex items-center gap-2 text-slate-800 dark:text-white"><i data-lucide="calendar" class="w-4 h-4 text-sky-500"></i> Agenda</h2>
                    <span id="agendaCount" class="text-xs font-mono bg-sky-100 dark:bg-sky-500/10 text-sky-600 dark:text-sky-400 px-2 py-1 rounded">0</span>
                </div>
                <div id="agendaList" class="flex-1 overflow-y-auto space-y-3 z-10 pr-1 pb-10">
                    <!-- Items -->
                </div>
                <div id="agendaEmpty" class="absolute inset-0 flex flex-col items-center justify-center text-slate-400 dark:text-slate-600 z-0 hidden">
                    <i data-lucide="calendar-off" class="w-10 h-10 mb-2 opacity-20"></i>
                    <span class="text-xs">Livre hoje</span>
                </div>
            </div>

            <!-- TASKS (Inbox) -->
            <div class="glass-panel rounded-3xl p-5 flex flex-col h-[350px]">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="font-bold flex items-center gap-2 text-slate-800 dark:text-white"><i data-lucide="check-square" class="w-4 h-4 text-emerald-500"></i> Tarefas</h2>
                    <div class="flex gap-1">
                        <button onclick="filterTasks('all')" id="ft-all" class="text-[10px] px-2 py-1 rounded bg-slate-200 dark:bg-white/10 text-slate-900 dark:text-white">Todos</button>
                        <button onclick="filterTasks('active')" id="ft-active" class="text-[10px] px-2 py-1 rounded hover:bg-slate-200 dark:hover:bg-white/10 text-slate-500 dark:text-slate-400">Pendentes</button>
                    </div>
                </div>
                <div class="relative w-full mb-3">
                    <input type="text" id="quickTaskInput" placeholder="+ R√°pido (Enter)..." class="w-full bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-xl px-3 py-2 text-sm focus:outline-none focus:border-emerald-500/50 transition text-slate-800 dark:text-white" onkeydown="if(event.key==='Enter') addQuickTask(this.value)">
                </div>
                <div id="taskList" class="flex-1 overflow-y-auto space-y-2 pr-1 pb-2">
                    <!-- Items -->
                </div>
            </div>

            <!-- SHOPPING LIST -->
            <div class="glass-panel rounded-3xl p-5 flex flex-col h-[350px]">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="font-bold flex items-center gap-2 text-slate-800 dark:text-white"><i data-lucide="shopping-cart" class="w-4 h-4 text-amber-500"></i> Compras</h2>
                    <button onclick="clearShopDone()" class="text-xs text-slate-400 hover:text-red-500" title="Limpar conclu√≠dos"><i data-lucide="trash-2" class="w-3 h-3"></i></button>
                </div>
                <div class="relative w-full mb-3">
                    <input type="text" id="quickShopInput" placeholder="+ Item..." class="w-full bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-xl px-3 py-2 text-sm focus:outline-none focus:border-amber-500/50 transition text-slate-800 dark:text-white" onkeydown="if(event.key==='Enter') addQuickShop(this.value)">
                </div>
                <div id="shopList" class="flex-1 overflow-y-auto space-y-2 pr-1">
                    <!-- Items -->
                </div>
            </div>

            <!-- QUICK NOTES -->
            <div class="glass-panel rounded-3xl p-5 flex flex-col md:col-span-2 lg:col-span-3 min-h-[180px]">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="font-bold flex items-center gap-2 text-slate-800 dark:text-white"><i data-lucide="sticky-note" class="w-4 h-4 text-violet-500"></i> Brain Dump</h2>
                    <span class="text-[10px] text-slate-400 dark:text-slate-500 flex items-center gap-1"><i data-lucide="save" class="w-3 h-3"></i> Auto-save</span>
                </div>
                <textarea id="brainDump" class="w-full flex-1 bg-transparent resize-none focus:outline-none text-sm text-slate-600 dark:text-slate-300 placeholder-slate-400 dark:placeholder-slate-600 leading-relaxed font-mono" placeholder="Ideias, pensamentos, rascunhos..."></textarea>
            </div>

        </div>
    </div>

    <!-- FAB -->
    <button onclick="openModal('create', 'agenda')" class="fab hover:rotate-90 transition-transform duration-300">
        <i data-lucide="plus" class="w-8 h-8"></i>
    </button>

    <!-- UNIVERSAL MODAL (ADD / EDIT) -->
    <div id="itemModal" class="fixed inset-0 z-[100] hidden items-end sm:items-center justify-center bg-black/60 dark:bg-black/80 backdrop-blur-sm" onclick="if(event.target===this) closeModal('itemModal')">
        <div class="bg-white dark:bg-[#1e293b] w-full sm:max-w-md rounded-t-3xl sm:rounded-3xl p-6 border-t sm:border border-slate-200 dark:border-slate-700 shadow-2xl animate-slide-up flex flex-col max-h-[90vh]">
            
            <!-- Modal Header -->
            <div class="flex justify-between items-center mb-6">
                <h3 id="modalTitle" class="font-bold text-lg text-slate-900 dark:text-white">Novo Item</h3>
                <button onclick="closeModal('itemModal')" class="bg-slate-100 dark:bg-slate-800 p-1.5 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700"><i data-lucide="x" class="w-5 h-5 text-slate-500 dark:text-slate-400"></i></button>
            </div>
            
            <!-- Type Tabs (Only shown in Create Mode) -->
            <div id="modalTabs" class="flex gap-2 mb-6 overflow-x-auto pb-1">
                <button onclick="switchTab('agenda')" id="tab-agenda" class="flex-1 py-2 px-3 rounded-xl border border-slate-300 dark:border-slate-600 text-xs font-bold transition whitespace-nowrap text-slate-500 dark:text-slate-400">Agenda</button>
                <button onclick="switchTab('task')" id="tab-task" class="flex-1 py-2 px-3 rounded-xl border border-slate-300 dark:border-slate-600 text-xs font-bold transition whitespace-nowrap text-slate-500 dark:text-slate-400">Tarefa</button>
                <button onclick="switchTab('goal')" id="tab-goal" class="flex-1 py-2 px-3 rounded-xl border border-slate-300 dark:border-slate-600 text-xs font-bold transition whitespace-nowrap text-slate-500 dark:text-slate-400">Meta</button>
                <button onclick="switchTab('shop')" id="tab-shop" class="flex-1 py-2 px-3 rounded-xl border border-slate-300 dark:border-slate-600 text-xs font-bold transition whitespace-nowrap text-slate-500 dark:text-slate-400">Compra</button>
            </div>

            <div class="flex-1 overflow-y-auto pr-1 space-y-4">
                <input type="hidden" id="editId">
                <input type="hidden" id="currentType">

                <!-- Common Title -->
                <div>
                    <label class="text-[10px] uppercase font-bold text-slate-500 mb-1 block">T√≠tulo / Nome</label>
                    <input type="text" id="inpTitle" class="w-full bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-xl p-3 focus:border-sky-500 outline-none text-slate-900 dark:text-white placeholder-slate-400 dark:placeholder-slate-600">
                </div>

                <!-- Fields: Agenda -->
                <div id="fields-agenda" class="space-y-4 hidden field-group">
                    <div class="flex gap-3">
                        <div class="flex-1">
                            <label class="text-[10px] uppercase font-bold text-slate-500 mb-1 block">Data</label>
                            <input type="date" id="inpDate" class="w-full bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-xl p-3 focus:border-sky-500 outline-none text-slate-600 dark:text-slate-300 text-sm">
                        </div>
                        <div class="w-28">
                            <label class="text-[10px] uppercase font-bold text-slate-500 mb-1 block">Hora</label>
                            <input type="time" id="inpTime" class="w-full bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-xl p-3 focus:border-sky-500 outline-none text-slate-600 dark:text-slate-300 text-sm">
                        </div>
                    </div>
                    <div>
                        <label class="text-[10px] uppercase font-bold text-slate-500 mb-1 block">Local</label>
                        <div class="relative">
                            <i data-lucide="map-pin" class="absolute left-3 top-3.5 w-4 h-4 text-slate-400 dark:text-slate-500"></i>
                            <input type="text" id="inpLoc" class="w-full bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-xl p-3 pl-9 focus:border-sky-500 outline-none text-sm text-slate-900 dark:text-white placeholder-slate-400 dark:placeholder-slate-600" placeholder="Ex: Escrit√≥rio, Google Meet">
                        </div>
                    </div>
                </div>

                <!-- Fields: Task -->
                <div id="fields-task" class="space-y-4 hidden field-group">
                    <div>
                        <label class="text-[10px] uppercase font-bold text-slate-500 mb-2 block">Prioridade</label>
                        <div class="grid grid-cols-3 gap-2">
                            <label class="cursor-pointer">
                                <input type="radio" name="prio" value="high" class="peer hidden">
                                <div class="py-2 rounded-xl border border-slate-300 dark:border-slate-700 text-center text-xs font-bold text-slate-500 dark:text-slate-400 peer-checked:bg-red-100 dark:peer-checked:bg-red-500/20 peer-checked:border-red-500 peer-checked:text-red-500 transition">Alta üî•</div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="prio" value="medium" class="peer hidden">
                                <div class="py-2 rounded-xl border border-slate-300 dark:border-slate-700 text-center text-xs font-bold text-slate-500 dark:text-slate-400 peer-checked:bg-orange-100 dark:peer-checked:bg-orange-500/20 peer-checked:border-orange-500 peer-checked:text-orange-500 transition">M√©dia</div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="prio" value="low" class="peer hidden" checked>
                                <div class="py-2 rounded-xl border border-slate-300 dark:border-slate-700 text-center text-xs font-bold text-slate-500 dark:text-slate-400 peer-checked:bg-blue-100 dark:peer-checked:bg-blue-500/20 peer-checked:border-blue-500 peer-checked:text-blue-500 transition">Baixa</div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Fields: Goal -->
                <div id="fields-goal" class="space-y-4 hidden field-group">
                    <div>
                        <label class="text-[10px] uppercase font-bold text-slate-500 mb-1 block">Categoria</label>
                        <input type="text" id="inpCategory" class="w-full bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-xl p-3 focus:border-pink-500 outline-none text-sm text-slate-900 dark:text-white placeholder-slate-400 dark:placeholder-slate-600" placeholder="Ex: Financeiro, Sa√∫de, Estudo">
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-[10px] uppercase font-bold text-slate-500 mb-1 block">In√≠cio</label>
                            <input type="date" id="inpStart" class="w-full bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-xl p-3 focus:border-pink-500 outline-none text-slate-600 dark:text-slate-300 text-sm">
                        </div>
                        <div>
                            <label class="text-[10px] uppercase font-bold text-slate-500 mb-1 block">Fim (Prazo)</label>
                            <input type="date" id="inpEnd" class="w-full bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-xl p-3 focus:border-pink-500 outline-none text-slate-600 dark:text-slate-300 text-sm">
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between mb-1">
                            <label class="text-[10px] uppercase font-bold text-slate-500 block">Progresso</label>
                            <span id="progVal" class="text-xs font-mono font-bold text-pink-500">0%</span>
                        </div>
                        <input type="range" id="inpProgress" min="0" max="100" value="0" class="w-full accent-pink-500 h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer" oninput="document.getElementById('progVal').innerText = this.value + '%'">
                    </div>
                </div>

                <!-- Shop has no extra fields besides title -->

            </div>

            <!-- Footer Buttons -->
            <div class="mt-6 flex gap-3">
                <button id="btnDelete" onclick="confirmDelete()" class="hidden px-4 py-3 bg-red-100 hover:bg-red-200 dark:bg-red-500/10 dark:hover:bg-red-500/20 text-red-500 border border-red-200 dark:border-red-500/30 rounded-xl transition"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
                <button onclick="saveItem()" id="btnSave" class="flex-1 py-3 bg-sky-600 hover:bg-sky-500 text-white font-bold rounded-xl shadow-lg shadow-sky-500/20 transition">Criar Item</button>
            </div>
        </div>
    </div>

    <!-- CONFIRM DELETE MODAL -->
    <div id="confirmModal" class="fixed inset-0 z-[110] hidden items-center justify-center bg-black/80 backdrop-blur-sm px-4">
        <div class="bg-white dark:bg-[#1e293b] w-full max-w-xs rounded-2xl p-6 border border-slate-200 dark:border-slate-700 shadow-2xl text-center animate-slide-up">
            <div class="w-14 h-14 bg-red-100 dark:bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-4 border border-red-200 dark:border-red-500/20">
                <i data-lucide="alert-triangle" class="w-7 h-7 text-red-500"></i>
            </div>
            <h3 class="font-bold text-slate-900 dark:text-white text-lg mb-2">Excluir Item?</h3>
            <p class="text-xs text-slate-500 dark:text-slate-400 mb-6">Essa a√ß√£o n√£o pode ser desfeita.</p>
            <div class="flex gap-3">
                <button onclick="document.getElementById('confirmModal').classList.add('hidden')" class="flex-1 py-2.5 bg-slate-200 hover:bg-slate-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-700 dark:text-white rounded-xl text-xs font-bold transition">Cancelar</button>
                <button onclick="performDelete()" class="flex-1 py-2.5 bg-red-600 hover:bg-red-500 text-white rounded-xl text-xs font-bold transition shadow-lg shadow-red-500/20">Excluir</button>
            </div>
        </div>
    </div>

    <!-- SYNC MODAL -->
    <div id="syncModal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/80 backdrop-blur-sm" onclick="if(event.target===this) closeModal('syncModal')">
        <div class="bg-white dark:bg-[#1e293b] w-[90%] max-w-sm rounded-3xl p-6 border border-slate-200 dark:border-slate-700 shadow-2xl">
            <div class="text-center mb-6">
                <div class="w-12 h-12 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-3"><i data-lucide="cloud" class="w-6 h-6 text-sky-500 dark:text-sky-400"></i></div>
                <h3 class="font-bold text-lg text-slate-900 dark:text-white">Sincroniza√ß√£o</h3>
                <p class="text-xs text-slate-500 dark:text-slate-400">Benai Tracker DB</p>
            </div>
            <div class="space-y-3">
                <button onclick="syncCloud()" class="w-full py-3 bg-sky-600 hover:bg-sky-500 text-white font-bold rounded-xl flex items-center justify-center gap-2">
                    <i data-lucide="refresh-cw" class="w-4 h-4"></i> Sincronizar Agora
                </button>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="exportJSON()" class="py-3 border border-slate-300 dark:border-slate-600 rounded-xl text-xs font-bold text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-white/5">Baixar JSON</button>
                    <label class="py-3 border border-slate-300 dark:border-slate-600 rounded-xl text-xs font-bold text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-white/5 flex items-center justify-center cursor-pointer">
                        Restaurar
                        <input type="file" hidden onchange="importJSON(this)">
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- TOAST -->
    <div id="toast" class="fixed top-6 left-1/2 -translate-x-1/2 bg-white text-slate-900 px-6 py-2 rounded-full font-bold shadow-xl translate-y-[-200%] transition-transform duration-300 z-[110] flex items-center gap-2 border border-slate-100">
        <i data-lucide="check-circle" class="w-4 h-4 text-emerald-500"></i>
        <span id="toastMsg" class="text-xs">Salvo</span>
    </div>

    <script>
        // CONFIG
        const DB_KEY = 'benai_tracker_v3';
        const GIST_DESC = 'BENAI_TRACKER_DB';
        const TOKEN_KEY = 'BENAI_GLOBAL_TOKEN';
        const PIN = "16359001";

        let db = {
            agenda: [],
            tasks: [], 
            shop: [],
            goals: [], 
            note: ""
        };

        let selectedDate = new Date().toISOString().split('T')[0];
        let gistId = null;
        let deleteTarget = null; 

        // INIT
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            initTheme();
            checkGatekeeper();
            
            document.getElementById('historyPicker').value = selectedDate;
            updateHeaderDate();
            
            document.getElementById('brainDump').addEventListener('input', (e) => {
                db.note = e.target.value;
                localStorage.setItem(DB_KEY, JSON.stringify(db));
            });
        });

        // --- THEME ---
        function initTheme() {
            const saved = localStorage.getItem('benai_theme');
            const html = document.documentElement;
            const icon = document.getElementById('themeIcon');
            
            if (saved === 'light') {
                html.classList.remove('dark');
                icon.setAttribute('data-lucide', 'sun');
            } else {
                // Default Dark
                html.classList.add('dark');
                icon.setAttribute('data-lucide', 'moon');
            }
            lucide.createIcons();
        }

        function toggleTheme() {
            const html = document.documentElement;
            const icon = document.getElementById('themeIcon');
            
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.setItem('benai_theme', 'light');
                icon.setAttribute('data-lucide', 'sun');
            } else {
                html.classList.add('dark');
                localStorage.setItem('benai_theme', 'dark');
                icon.setAttribute('data-lucide', 'moon');
            }
            lucide.createIcons();
        }

        // --- AUTH ---
        function checkGatekeeper() {
            if(sessionStorage.getItem('benai_auth') === 'true') {
                unlockApp();
            } else {
                document.getElementById('pinInput').addEventListener('keyup', (e) => {
                    if(e.target.value === PIN) {
                        sessionStorage.setItem('benai_auth', 'true');
                        unlockApp();
                    } else if(e.target.value.length === 8) {
                        e.target.value = '';
                        e.target.classList.add('border-red-500', 'text-red-500');
                        setTimeout(()=>e.target.classList.remove('border-red-500', 'text-red-500'), 500);
                    }
                });
            }
        }

        function unlockApp() {
            document.getElementById('gatekeeper').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('gatekeeper').style.display = 'none';
                document.getElementById('app').style.opacity = '1';
                loadData();
            }, 500);
        }

        // --- DATA LOAD ---
        async function loadData() {
            const local = localStorage.getItem(DB_KEY);
            if(local) {
                db = JSON.parse(local);
                if(!db.shop) db.shop = [];
                if(!db.goals) db.goals = [];
                db.tasks.forEach(t => {
                    if(t.urgent === true && !t.priority) t.priority = 'high';
                    if(!t.priority) t.priority = 'low';
                });
            }
            
            renderTimeline();
            renderAll();
            
            if(localStorage.getItem(TOKEN_KEY)) {
                syncCloud(true);
            }
        }

        function saveData() {
            localStorage.setItem(DB_KEY, JSON.stringify(db));
            renderAll();
            showToast('Salvo');
        }

        // --- RENDERING & DATE LOGIC ---
        function changeDate(val) {
            if(!val) return;
            selectedDate = val;
            renderTimeline();
            renderAgenda();
            updateHeaderDate();
        }

        function updateHeaderDate() {
            const parts = selectedDate.split('-');
            const dateObj = new Date(parts[0], parts[1]-1, parts[2]); // Avoid timezone issues
            const opt = { month: 'long', year: 'numeric' };
            document.getElementById('headerDate').innerText = dateObj.toLocaleDateString('pt-BR', opt).toUpperCase();
        }

        function renderTimeline() {
            const container = document.getElementById('timelineContainer');
            container.innerHTML = '';
            
            // Calculate Monday of the selected week
            const current = new Date(selectedDate + 'T00:00:00'); // Ensure local time
            const day = current.getDay(); // 0 (Sun) - 6 (Sat)
            const diff = current.getDate() - day + (day === 0 ? -6 : 1); // Adjust when day is Sunday
            const monday = new Date(current.setDate(diff));
            
            const todayISO = new Date().toISOString().split('T')[0];

            for(let i = 0; i < 7; i++) {
                const d = new Date(monday);
                d.setDate(monday.getDate() + i);
                const iso = d.toISOString().split('T')[0];
                const dayNum = d.getDate();
                const dayName = d.toLocaleDateString('pt-BR', {weekday: 'short'}).replace('.','');
                
                const isActive = iso === selectedDate;
                const isToday = iso === todayISO;
                
                let activeClass = isActive ? 'active' : 'bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700';
                const todayClass = isToday ? 'today' : '';

                const btn = document.createElement('button');
                btn.className = `flex-1 min-w-[3.5rem] h-16 rounded-2xl flex flex-col items-center justify-center date-card ${activeClass} ${todayClass}`;
                btn.innerHTML = `<span class="text-[10px] uppercase font-bold opacity-70">${dayName}</span><span class="text-xl font-mono font-bold">${dayNum}</span>`;
                btn.onclick = () => { 
                    selectedDate = iso; 
                    renderTimeline(); 
                    renderAgenda();
                    document.getElementById('historyPicker').value = selectedDate; 
                };
                container.appendChild(btn);
            }
        }

        function renderAll() {
            renderGoals();
            renderAgenda();
            renderTasks();
            renderShop();
            document.getElementById('brainDump').value = db.note || "";
        }

        // --- GOALS ---
        function renderGoals() {
            const c = document.getElementById('goalsContainer');
            c.innerHTML = '';
            
            if(db.goals.length === 0) {
                c.innerHTML = '<div class="text-xs text-slate-400 dark:text-slate-600 pl-1 italic">Nenhuma meta definida.</div>';
                return;
            }

            db.goals.forEach(g => {
                const prog = g.progress || 0;
                let timeLeft = "";
                if(g.end) {
                    const diff = new Date(g.end) - new Date();
                    const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
                    timeLeft = days > 0 ? `${days} dias` : 'Vencido';
                } else {
                    timeLeft = 'Indefinido';
                }

                const card = document.createElement('div');
                card.className = "min-w-[220px] bg-white dark:bg-[#1e293b] border border-slate-200 dark:border-slate-700 rounded-2xl p-4 flex flex-col justify-between snap-center cursor-pointer hover:border-pink-500/50 transition";
                card.onclick = () => openModal('edit', 'goal', g.id);
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-[10px] font-bold text-pink-500 dark:text-pink-400 uppercase bg-pink-500/10 px-2 py-0.5 rounded">${g.type || 'Geral'}</span>
                        <span class="text-[10px] text-slate-500">${timeLeft}</span>
                    </div>
                    <h4 class="font-bold text-slate-800 dark:text-white mb-3 text-sm truncate">${g.title}</h4>
                    <div>
                        <div class="flex justify-between text-[10px] text-slate-400 mb-1 font-mono"><span>Progresso</span><span>${prog}%</span></div>
                        <div class="progress-bar-bg"><div class="progress-bar-fill bg-gradient-to-r from-pink-500 to-rose-500" style="width: ${prog}%"></div></div>
                    </div>
                `;
                c.appendChild(card);
            });
        }

        // --- AGENDA ---
        function renderAgenda() {
            const list = document.getElementById('agendaList');
            const items = db.agenda.filter(i => i.date === selectedDate).sort((a,b) => a.time.localeCompare(b.time));
            document.getElementById('agendaCount').innerText = items.length;
            document.getElementById('agendaEmpty').classList.toggle('hidden', items.length > 0);
            
            list.innerHTML = '';
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'flex items-start gap-3 p-3 rounded-xl bg-white/50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 border border-slate-200 dark:border-slate-700/50 transition cursor-pointer border-l-4 border-l-sky-500';
                div.onclick = () => openModal('edit', 'agenda', item.id);
                div.innerHTML = `
                    <div class="flex flex-col items-center min-w-[3rem] pt-1">
                        <span class="font-mono text-lg font-bold text-slate-700 dark:text-white">${item.time}</span>
                    </div>
                    <div class="h-full w-px bg-slate-200 dark:bg-slate-700 mx-1"></div>
                    <div class="flex-1 min-w-0">
                        <h4 class="font-bold text-sm text-slate-800 dark:text-slate-200">${item.title}</h4>
                        <p class="text-[11px] text-sky-500 dark:text-sky-400 flex items-center gap-1 mt-0.5"><i data-lucide="map-pin" class="w-3 h-3"></i> ${item.loc || 'Sem local'}</p>
                    </div>
                `;
                list.appendChild(div);
            });
            lucide.createIcons();
        }

        // --- TASKS ---
        let taskFilter = 'all';
        function filterTasks(t) {
            taskFilter = t;
            document.getElementById('ft-all').className = t==='all' ? 'text-[10px] px-2 py-1 rounded bg-slate-200 dark:bg-white/10 text-slate-900 dark:text-white' : 'text-[10px] px-2 py-1 rounded hover:bg-slate-200 dark:hover:bg-white/10 text-slate-500 dark:text-slate-400';
            document.getElementById('ft-active').className = t==='active' ? 'text-[10px] px-2 py-1 rounded bg-slate-200 dark:bg-white/10 text-slate-900 dark:text-white' : 'text-[10px] px-2 py-1 rounded hover:bg-slate-200 dark:hover:bg-white/10 text-slate-500 dark:text-slate-400';
            renderTasks();
        }

        function renderTasks() {
            const list = document.getElementById('taskList');
            list.innerHTML = '';
            let items = db.tasks;
            if(taskFilter === 'active') items = items.filter(t => !t.done);
            
            const prioVal = { 'high': 3, 'medium': 2, 'low': 1 };
            items.sort((a,b) => (prioVal[b.priority] || 1) - (prioVal[a.priority] || 1));

            items.forEach(item => {
                const prioClass = item.priority === 'high' ? 'prio-high' : item.priority === 'medium' ? 'prio-med' : 'prio-low';
                const div = document.createElement('div');
                div.className = `task-item flex items-center gap-3 p-3 rounded-lg border-y border-r border-slate-200 dark:border-slate-700/50 ${prioClass} ${item.done ? 'task-done' : ''} cursor-pointer group`;
                div.onclick = () => openModal('edit', 'task', item.id);
                div.innerHTML = `
                    <div onclick="event.stopPropagation(); toggleDone('tasks', '${item.id}')" class="w-5 h-5 rounded border ${item.done ? 'bg-emerald-500 border-emerald-500' : 'border-slate-400 dark:border-slate-500'} flex items-center justify-center cursor-pointer transition shrink-0 bg-white/50 dark:bg-black/20">
                        ${item.done ? '<i data-lucide="check" class="w-3 h-3 text-white"></i>' : ''}
                    </div>
                    <span class="flex-1 text-sm ${item.priority==='high' && !item.done ? 'text-slate-900 dark:text-white font-medium' : 'text-slate-600 dark:text-slate-300'}">${item.title}</span>
                `;
                list.appendChild(div);
            });
            lucide.createIcons();
        }

        function addQuickTask(val) {
            if(!val.trim()) return;
            db.tasks.push({ id: Date.now().toString(), title: val, done: false, priority: 'medium' });
            document.getElementById('quickTaskInput').value = '';
            saveData();
        }

        // --- SHOPPING ---
        function renderShop() {
            const list = document.getElementById('shopList');
            list.innerHTML = '';
            db.shop.forEach(item => {
                const div = document.createElement('div');
                div.className = `flex items-center gap-2 p-2 rounded-lg shop-item hover:bg-slate-200 dark:hover:bg-slate-800/80 ${item.done ? 'opacity-40' : ''} cursor-pointer`;
                div.onclick = (e) => { if(!e.target.closest('.check-box')) openModal('edit', 'shop', item.id) };
                div.innerHTML = `
                    <div class="check-box w-4 h-4 rounded-full border ${item.done ? 'bg-amber-500 border-amber-500' : 'border-slate-400 dark:border-slate-500'} cursor-pointer" onclick="event.stopPropagation(); toggleDone('shop', '${item.id}')"></div>
                    <span class="flex-1 text-sm text-slate-700 dark:text-slate-300 ${item.done ? 'line-through' : ''}">${item.title}</span>
                `;
                list.appendChild(div);
            });
        }
        function addQuickShop(val) {
            if(!val.trim()) return;
            db.shop.push({ id: Date.now().toString(), title: val, done: false });
            document.getElementById('quickShopInput').value = '';
            saveData();
        }
        function clearShopDone() {
            if(confirm('Remover itens conclu√≠dos?')) {
                db.shop = db.shop.filter(i => !i.done);
                saveData();
            }
        }

        // --- MODAL LOGIC (ADD / EDIT) ---
        function openModal(mode, type, id = null) {
            const modal = document.getElementById('itemModal');
            document.getElementById('currentType').value = type;
            
            document.querySelectorAll('.field-group').forEach(el => el.classList.add('hidden'));
            document.getElementById('inpTitle').value = '';
            
            if (mode === 'create') {
                document.getElementById('modalTitle').innerText = 'Novo Item';
                document.getElementById('editId').value = '';
                document.getElementById('btnSave').innerText = 'Criar';
                document.getElementById('btnDelete').classList.add('hidden');
                document.getElementById('modalTabs').classList.remove('hidden');
                switchTab(type);
                
                if(type === 'agenda') {
                    document.getElementById('inpDate').value = selectedDate;
                    document.getElementById('inpTime').value = new Date().toTimeString().slice(0,5);
                    document.getElementById('inpLoc').value = '';
                }
                if(type === 'task') {
                    document.querySelector('input[name="prio"][value="medium"]').checked = true;
                }
                if(type === 'goal') {
                    document.getElementById('inpStart').value = selectedDate;
                    document.getElementById('inpCategory').value = '';
                    document.getElementById('inpProgress').value = 0;
                    document.getElementById('progVal').innerText = "0%";
                }

            } else {
                document.getElementById('modalTitle').innerText = 'Editar Item';
                document.getElementById('editId').value = id;
                document.getElementById('btnSave').innerText = 'Salvar Altera√ß√µes';
                document.getElementById('btnDelete').classList.remove('hidden');
                document.getElementById('modalTabs').classList.add('hidden');
                
                let item;
                if(type === 'agenda') item = db.agenda.find(x=>x.id===id);
                if(type === 'task') item = db.tasks.find(x=>x.id===id);
                if(type === 'goal') item = db.goals.find(x=>x.id===id);
                if(type === 'shop') item = db.shop.find(x=>x.id===id);

                if(!item) return;

                document.getElementById('inpTitle').value = item.title;
                showFields(type);

                if(type === 'agenda') {
                    document.getElementById('inpDate').value = item.date;
                    document.getElementById('inpTime').value = item.time;
                    document.getElementById('inpLoc').value = item.loc || '';
                }
                if(type === 'task') {
                    const p = item.priority || 'low';
                    const radio = document.querySelector(`input[name="prio"][value="${p}"]`);
                    if(radio) radio.checked = true;
                }
                if(type === 'goal') {
                    document.getElementById('inpCategory').value = item.type || '';
                    document.getElementById('inpStart').value = item.start || '';
                    document.getElementById('inpEnd').value = item.end || '';
                    document.getElementById('inpProgress').value = item.progress || 0;
                    document.getElementById('progVal').innerText = (item.progress || 0) + "%";
                }
            }

            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function switchTab(type) {
            document.getElementById('currentType').value = type;
            ['agenda','task','goal','shop'].forEach(t => {
                const btn = document.getElementById('tab-'+t);
                if(t === type) {
                    btn.classList.add('bg-white', 'dark:bg-white', 'text-slate-900', 'border-slate-300', 'dark:border-white');
                    btn.classList.remove('text-slate-500', 'dark:text-slate-400', 'border-slate-300', 'dark:border-slate-600');
                } else {
                    btn.classList.remove('bg-white', 'dark:bg-white', 'text-slate-900', 'border-slate-300', 'dark:border-white');
                    btn.classList.add('text-slate-500', 'dark:text-slate-400', 'border-slate-300', 'dark:border-slate-600');
                }
            });
            showFields(type);
        }

        function showFields(type) {
            document.querySelectorAll('.field-group').forEach(el => el.classList.add('hidden'));
            const group = document.getElementById('fields-'+type);
            if(group) group.classList.remove('hidden');
        }

        function saveItem() {
            const type = document.getElementById('currentType').value;
            const id = document.getElementById('editId').value;
            const title = document.getElementById('inpTitle').value;

            if(!title) return alert('O t√≠tulo √© obrigat√≥rio.');

            let newData = { title };

            if(type === 'agenda') {
                newData.date = document.getElementById('inpDate').value;
                newData.time = document.getElementById('inpTime').value;
                newData.loc = document.getElementById('inpLoc').value;
                if(!newData.date || !newData.time) return alert('Data e hora s√£o obrigat√≥rios.');
            }
            if(type === 'task') {
                const radios = document.getElementsByName('prio');
                for(let r of radios) if(r.checked) newData.priority = r.value;
            }
            if(type === 'goal') {
                newData.type = document.getElementById('inpCategory').value;
                newData.start = document.getElementById('inpStart').value;
                newData.end = document.getElementById('inpEnd').value;
                newData.progress = document.getElementById('inpProgress').value;
            }

            if(id) {
                if(type==='agenda') { const i=db.agenda.findIndex(x=>x.id===id); db.agenda[i]={...db.agenda[i], ...newData}; }
                if(type==='task') { const i=db.tasks.findIndex(x=>x.id===id); db.tasks[i]={...db.tasks[i], ...newData}; }
                if(type==='shop') { const i=db.shop.findIndex(x=>x.id===id); db.shop[i]={...db.shop[i], ...newData}; }
                if(type==='goal') { const i=db.goals.findIndex(x=>x.id===id); db.goals[i]={...db.goals[i], ...newData}; }
            } else {
                newData.id = Date.now().toString();
                if(type !== 'goal') newData.done = false;
                
                if(type==='agenda') db.agenda.push(newData);
                if(type==='task') db.tasks.push(newData);
                if(type==='shop') db.shop.push(newData);
                if(type==='goal') db.goals.push(newData);
            }

            closeModal('itemModal');
            saveData();
        }

        // --- DELETE LOGIC ---
        function confirmDelete() {
            const type = document.getElementById('currentType').value;
            const id = document.getElementById('editId').value;
            deleteTarget = { type, id };
            closeModal('itemModal');
            document.getElementById('confirmModal').classList.remove('hidden');
            document.getElementById('confirmModal').classList.add('flex');
        }

        function performDelete() {
            if(!deleteTarget) return;
            const { type, id } = deleteTarget;
            
            if(type === 'agenda') db.agenda = db.agenda.filter(x => x.id !== id);
            if(type === 'task') db.tasks = db.tasks.filter(x => x.id !== id);
            if(type === 'shop') db.shop = db.shop.filter(x => x.id !== id);
            if(type === 'goal') db.goals = db.goals.filter(x => x.id !== id);

            document.getElementById('confirmModal').classList.add('hidden');
            saveData();
        }

        // --- HELPERS ---
        function toggleDone(type, id) {
            const arr = db[type];
            const item = arr.find(i => i.id === id);
            if(item) {
                item.done = !item.done;
                if(item.done && type !== 'shop') confetti({ particleCount: 30, spread: 50, origin: { y: 0.6 } });
                saveData();
            }
        }

        function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
            document.getElementById(id).classList.remove('flex');
        }
        function openSyncModal() {
            document.getElementById('syncModal').classList.remove('hidden');
            document.getElementById('syncModal').classList.add('flex');
        }
        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = msg;
            t.style.transform = 'translate(-50%, 0)';
            setTimeout(() => t.style.transform = 'translate(-50%, -200%)', 2000);
        }

        // --- CLOUD SYNC ---
        async function syncCloud(silent = false) {
            const token = localStorage.getItem(TOKEN_KEY);
            if(!token) {
                if(!silent) alert('Configure o Token Global no Hub primeiro.');
                return updateSyncStatus(false);
            }
            if(!silent) showToast('Sincronizando...');
            updateSyncStatus(null, true);

            try {
                if(!gistId) {
                    const req = await fetch('https://api.github.com/gists', { headers: { Authorization: `token ${token}` } });
                    const gists = await req.json();
                    const found = gists.find(g => g.description === GIST_DESC);
                    if(found) gistId = found.id;
                }

                if(gistId) {
                    let url = `https://api.github.com/gists/${gistId}`;
                    let payload = { files: { "tracker.json": { content: JSON.stringify(db) } } };
                    await fetch(url, { method: 'PATCH', headers: { Authorization: `token ${token}` }, body: JSON.stringify(payload) });
                } else {
                    await fetch('https://api.github.com/gists', {
                        method: 'POST',
                        headers: { Authorization: `token ${token}` },
                        body: JSON.stringify({ description: GIST_DESC, public: false, files: { "tracker.json": { content: JSON.stringify(db) } } })
                    });
                }
                updateSyncStatus(true);
                if(!silent) showToast('Sincronizado na Nuvem!');
                closeModal('syncModal');
            } catch(e) {
                console.error(e);
                updateSyncStatus(false);
                if(!silent) alert('Erro na sincroniza√ß√£o');
            }
        }

        function updateSyncStatus(ok, loading=false) {
            const dot = document.getElementById('syncDot');
            if(loading) { dot.className = "absolute top-2 right-2 w-2 h-2 rounded-full bg-amber-500 animate-pulse"; return; }
            if(ok) dot.className = "absolute top-2 right-2 w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.8)]";
            else dot.className = "absolute top-2 right-2 w-2 h-2 rounded-full bg-slate-500 dark:bg-slate-500";
        }

        function exportJSON() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(db));
            const anchor = document.createElement('a'); anchor.setAttribute("href", dataStr); anchor.setAttribute("download", "benai_tracker_backup.json"); anchor.click();
        }

        function importJSON(input) {
            const file = input.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try { db = JSON.parse(e.target.result); saveData(); alert('Dados restaurados.'); location.reload(); } catch(e) { alert('Arquivo inv√°lido'); }
            };
            reader.readAsText(file);
        }
    </script>
</body>
</html>
