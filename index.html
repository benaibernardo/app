
<!DOCTYPE html>
<html lang="pt-br" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Benai App | Central</title>
    
    <!-- LIBS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;800&family=Space+Grotesk:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- CONFIGURAÇÃO TAILWIND -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                        mono: ['Space Grotesk', 'monospace'],
                    },
                    colors: {
                        brand: {
                            dark: '#0f172a',
                            light: '#e0f2fe',
                            accent: '#0ea5e9',
                            orange: '#f97316'
                        }
                    },
                    animation: {
                        'float': 'float 10s infinite ease-in-out',
                        'bounce-slow': 'bounce 3s infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0) scale(1)' },
                            '50%': { transform: 'translateY(-20px) scale(1.05)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* BASE & BACKGROUND */
        body { transition: background-color 0.5s ease, color 0.5s ease; background-attachment: fixed; }
        
        .orb { position: fixed; border-radius: 50%; filter: blur(80px); z-index: -1; opacity: 0.5; animation: float 15s infinite alternate; }
        
        /* Glass Cards */
        .glass-card { background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.4); box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1); transition: all 0.3s ease; }
        .dark .glass-card { background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(56, 189, 248, 0.15); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3); }
        
        .hover-lift:hover { 
            transform: translateY(-8px); 
            box-shadow: 0 20px 40px -5px rgba(249, 115, 22, 0.15); 
            border-color: rgba(249, 115, 22, 0.4); 
        }
        .hover-lift:active { transform: scale(0.96); }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #38bdf8; border-radius: 4px; }
        
        .pin-digit { font-family: 'Space Grotesk', monospace; letter-spacing: 0.2em; text-align: center; }
        .logo-b { background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%); box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.5); }
        
        /* Toggles */
        .toggle-checkbox:checked { right: 0; border-color: #f97316; }
        .toggle-checkbox:checked + .toggle-label { background-color: #f97316; }
        
        /* APP FRAME */
        #app-frame-container {
            position: fixed; inset: 0; z-index: 9000; background: #0f172a;
            transform: translateY(100%); transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #app-frame-container.open { transform: translateY(0); }
        iframe { width: 100%; height: 100%; border: none; }

        /* PSYDUCK CONFUSED ICON */
        .psy-icon-wrapper { position: relative; display: inline-block; }
        .psy-q-mark { 
            position: absolute; top: -5px; right: -5px; 
            font-weight: 900; color: #f97316; font-size: 1.2rem; 
            animation: bounce-slow 2s infinite; text-shadow: 0 2px 0 rgba(0,0,0,0.2);
        }

        /* CENTERED MODAL ANIMATION */
        .modal-enter { animation: modalPop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes modalPop { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="bg-sky-50 text-slate-800 dark:bg-[#0b1121] dark:text-sky-50 min-h-screen selection:bg-orange-400 selection:text-white overflow-x-hidden">

    <!-- BACKGROUND ANIMATION -->
    <div class="orb w-[500px] h-[500px] bg-sky-300/30 dark:bg-blue-600/20 top-[-10%] left-[-10%]"></div>
    <div class="orb w-[400px] h-[400px] bg-orange-200/30 dark:bg-orange-600/10 bottom-[10%] right-[-5%] animation-delay-2000"></div>
    <div class="orb w-[300px] h-[300px] bg-indigo-300/30 dark:bg-indigo-600/20 top-[40%] left-[30%] animation-delay-4000"></div>

    <!-- GATEKEEPER -->
    <div id="gatekeeper" class="fixed inset-0 z-[9999] flex flex-col items-center justify-center bg-sky-50/90 dark:bg-[#0b1121]/95 backdrop-blur-xl transition-all duration-700">
        <div class="text-center space-y-8 animate-float px-6">
            <div class="w-24 h-24 mx-auto rounded-3xl logo-b flex items-center justify-center rotate-3 hover:rotate-0 transition-transform duration-500 ring-4 ring-white/10">
                <span class="font-mono text-6xl font-bold text-white tracking-tighter">B.</span>
            </div>
            <div>
                <h1 class="text-3xl font-bold tracking-tight font-sans text-slate-700 dark:text-white">BENAI APP</h1>
            </div>
            <div class="relative group flex flex-col gap-4 w-64 mx-auto">
                <input type="text" id="userInput" class="pin-digit w-full bg-transparent border-b-2 border-slate-300 dark:border-sky-900/50 text-lg focus:outline-none focus:border-orange-500 transition-colors py-2 text-center placeholder-slate-400 dark:placeholder-slate-600 uppercase" placeholder="USUÁRIO" autocomplete="off">
                <input type="password" id="passInput" class="pin-digit w-full bg-transparent border-b-2 border-slate-300 dark:border-sky-900/50 text-lg focus:outline-none focus:border-orange-500 transition-colors py-2 text-center placeholder-slate-400 dark:placeholder-slate-600" placeholder="SENHA" onkeyup="if(event.key==='Enter') attemptLogin()">
                <button onclick="attemptLogin()" class="mt-4 w-full py-3 bg-sky-600 hover:bg-orange-500 text-white font-bold rounded-xl shadow-lg shadow-sky-500/20 hover:shadow-orange-500/30 transition tracking-widest text-xs">ENTRAR</button>
                <div id="pinError" class="absolute -bottom-10 left-0 right-0 text-red-500 text-xs font-bold opacity-0 transition-opacity text-center">CREDENCIAIS INVÁLIDAS</div>
            </div>
            
            <!-- Standard Gear Button for Config -->
            <button onclick="openGatekeeperConfig()" class="mt-8 p-3 rounded-full hover:bg-slate-200 dark:hover:bg-slate-800 transition text-slate-400 hover:text-orange-500">
                <i data-lucide="settings" class="w-5 h-5"></i>
            </button>
        </div>
    </div>

    <!-- APP CONTAINER -->
    <div id="app-container" class="max-w-5xl mx-auto px-6 py-10 opacity-0 transition-opacity duration-1000 flex flex-col items-center">
        
        <!-- HEADER -->
        <header class="text-center mb-16 relative w-full flex flex-col items-center">
            <div class="absolute right-0 top-0 flex gap-3">
                <button onclick="toggleTheme()" class="w-10 h-10 rounded-full glass-card flex items-center justify-center hover:bg-white/50 dark:hover:bg-sky-900/50 transition">
                    <i id="themeIcon" data-lucide="moon" class="w-5 h-5 text-slate-600 dark:text-sky-300"></i>
                </button>
                <button id="btn-settings" onclick="openSettings()" class="w-10 h-10 rounded-full glass-card flex items-center justify-center hover:bg-white/50 dark:hover:bg-sky-900/50 transition relative group">
                    <div id="syncIndicator" class="absolute top-0 right-0 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white dark:border-slate-900"></div>
                    <i data-lucide="settings-2" class="w-5 h-5 text-slate-600 dark:text-sky-300 group-hover:text-orange-500 transition"></i>
                </button>
            </div>
            <div class="w-20 h-20 rounded-2xl logo-b flex items-center justify-center mb-6 shadow-2xl shadow-blue-500/20 ring-4 ring-white/20 dark:ring-sky-900/30">
                <span class="font-mono text-5xl font-bold text-white tracking-tighter">B.</span>
            </div>
            
            <!-- BLUE TITLE SOLID -->
            <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight mb-2 text-sky-600 dark:text-sky-400">BENAI APP</h1>
            
            <div id="dateDisplay" class="mt-4 px-4 py-1.5 rounded-full bg-orange-100/50 dark:bg-orange-900/20 text-orange-600 dark:text-orange-300 text-xs font-bold uppercase tracking-wide border border-orange-200 dark:border-orange-700/50">Carregando data...</div>
        </header>

        <!-- MAIN CONTENT (SECTIONS) -->
        <div class="w-full space-y-12">

            <!-- SEÇÃO 1: VIDA PESSOAL -->
            <section class="animate-fade-in" style="animation-delay: 100ms;">
                <div class="flex items-center justify-center gap-4 mb-8">
                    <div class="h-px bg-gradient-to-r from-transparent via-orange-300 dark:via-orange-700 to-transparent w-24"></div>
                    <h2 class="text-lg font-bold text-slate-700 dark:text-sky-100 uppercase tracking-widest flex items-center gap-2"><i data-lucide="heart" class="w-4 h-4 text-orange-500"></i> Vida Pessoal</h2>
                    <div class="h-px bg-gradient-to-r from-transparent via-orange-300 dark:via-orange-700 to-transparent w-24"></div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 justify-center">
                    
                    <a href="#" onclick="launchApp('finance'); return false;" id="btn-finance" class="glass-card rounded-2xl p-5 hover-lift flex flex-col items-center text-center group">
                        <div class="w-12 h-12 rounded-xl bg-violet-100 dark:bg-violet-500/20 text-violet-600 dark:text-violet-400 flex items-center justify-center mb-3 group-hover:scale-110 transition-transform"><i data-lucide="pie-chart" class="w-6 h-6"></i></div>
                        <h3 class="font-bold text-slate-700 dark:text-white group-hover:text-orange-500 transition">Financeiro</h3>
                        <p class="text-[10px] uppercase font-bold text-slate-400 dark:text-slate-400 mt-1">Potes & Metas</p>
                    </a>

                    <!-- CARD BUTTON UPDATED (PSYDUCK CONFUSO + LABEL "CARTÃO") -->
                    <a href="#" onclick="launchApp('card'); return false;" id="btn-card" class="glass-card rounded-2xl p-5 hover-lift flex flex-col items-center text-center group">
                        <div class="w-12 h-12 rounded-xl bg-yellow-100 dark:bg-yellow-500/20 flex items-center justify-center mb-3 group-hover:scale-110 transition-transform psy-icon-wrapper">
                            <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/54.png" class="w-10 h-10 drop-shadow-sm">
                            <span class="psy-q-mark">?</span>
                        </div>
                        <h3 class="font-bold text-slate-700 dark:text-white group-hover:text-orange-500 transition">Cartão</h3>
                        <p class="text-[10px] uppercase font-bold text-slate-400 dark:text-slate-400 mt-1">Psyduck Manager</p>
                    </a>

                    <a href="#" onclick="launchApp('diet'); return false;" id="btn-diet" class="glass-card rounded-2xl p-5 hover-lift flex flex-col items-center text-center group">
                        <div class="w-12 h-12 rounded-xl bg-rose-100 dark:bg-rose-500/20 text-rose-600 dark:text-rose-400 flex items-center justify-center mb-3 group-hover:scale-110 transition-transform"><i data-lucide="apple" class="w-6 h-6"></i></div>
                        <h3 class="font-bold text-slate-700 dark:text-white group-hover:text-orange-500 transition">Dieta</h3>
                        <p class="text-[10px] uppercase font-bold text-slate-400 dark:text-slate-400 mt-1">Plano Alimentar</p>
                    </a>

                    <a href="#" onclick="launchApp('travel'); return false;" id="btn-travel" class="glass-card rounded-2xl p-5 hover-lift flex flex-col items-center text-center group">
                        <div class="w-12 h-12 rounded-xl bg-fuchsia-100 dark:bg-fuchsia-500/20 text-fuchsia-600 dark:text-fuchsia-400 flex items-center justify-center mb-3 group-hover:scale-110 transition-transform"><i data-lucide="plane" class="w-6 h-6"></i></div>
                        <h3 class="font-bold text-slate-700 dark:text-white group-hover:text-orange-500 transition">Viagens</h3>
                        <p class="text-[10px] uppercase font-bold text-slate-400 dark:text-slate-400 mt-1">Controle & Roteiros</p>
                    </a>
                </div>
            </section>

            <!-- SEÇÃO 2: CONSULTORIA -->
            <section id="sec-consultoria" class="animate-fade-in" style="animation-delay: 200ms;">
                <div class="flex items-center justify-center gap-4 mb-8">
                    <div class="h-px bg-gradient-to-r from-transparent via-orange-300 dark:via-orange-700 to-transparent w-24"></div>
                    <h2 class="text-lg font-bold text-slate-700 dark:text-sky-100 uppercase tracking-widest flex items-center gap-2"><i data-lucide="dumbbell" class="w-4 h-4 text-orange-500"></i> Consultoria</h2>
                    <div class="h-px bg-gradient-to-r from-transparent via-orange-300 dark:via-orange-700 to-transparent w-24"></div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-2 gap-4 max-w-2xl mx-auto">
                    <a href="#" onclick="launchApp('generator'); return false;" class="glass-card rounded-2xl p-6 hover-lift flex items-center gap-4 group">
                        <div class="w-12 h-12 rounded-xl bg-indigo-100 dark:bg-indigo-500/20 text-indigo-600 dark:text-indigo-400 flex items-center justify-center shrink-0"><i data-lucide="zap" class="w-6 h-6"></i></div>
                        <div class="text-left"><h3 class="font-bold text-slate-700 dark:text-white group-hover:text-orange-500 transition">Gerador</h3><p class="text-[10px] uppercase font-bold text-slate-400 dark:text-slate-400 mt-0.5">Criar Treinos</p></div>
                    </a>
                    <a href="#" class="glass-card rounded-2xl p-6 hover-lift flex items-center gap-4 group">
                        <div class="w-12 h-12 rounded-xl bg-blue-100 dark:bg-blue-500/20 text-blue-600 dark:text-blue-400 flex items-center justify-center shrink-0"><i data-lucide="users" class="w-6 h-6"></i></div>
                        <div class="text-left"><h3 class="font-bold text-slate-700 dark:text-white group-hover:text-orange-500 transition">Portal Aluno</h3><p class="text-[10px] uppercase font-bold text-slate-400 dark:text-slate-400 mt-0.5">Área do Cliente</p></div>
                    </a>
                </div>
            </section>

            <!-- SEÇÃO 3: TRABALHO -->
            <section id="sec-trabalho" class="animate-fade-in" style="animation-delay: 300ms;">
                <div class="flex items-center justify-center gap-4 mb-8">
                    <div class="h-px bg-gradient-to-r from-transparent via-orange-300 dark:via-orange-700 to-transparent w-24"></div>
                    <h2 class="text-lg font-bold text-slate-700 dark:text-sky-100 uppercase tracking-widest flex items-center gap-2"><i data-lucide="briefcase" class="w-4 h-4 text-orange-500"></i> Trabalho</h2>
                    <div class="h-px bg-gradient-to-r from-transparent via-orange-300 dark:via-orange-700 to-transparent w-24"></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-1 gap-4 max-w-2xl mx-auto">
                    <a href="#" onclick="launchApp('prime'); return false;" class="glass-card rounded-2xl p-6 hover-lift flex flex-col justify-center group relative overflow-hidden border-sky-500/30 dark:border-sky-500/30">
                        <div class="absolute inset-0 bg-gradient-to-r from-sky-500/5 to-blue-500/5 dark:from-sky-500/10 dark:to-blue-500/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        <div class="relative z-10 flex items-center gap-4">
                            <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-sky-400 to-blue-600 text-white flex items-center justify-center shrink-0 shadow-lg shadow-sky-500/20"><i data-lucide="gem" class="w-7 h-7"></i></div>
                            <div><h3 class="text-xl font-bold text-slate-800 dark:text-white group-hover:text-orange-500 transition">Prime Acquafit</h3><p class="text-xs uppercase font-bold text-sky-600 dark:text-sky-300 mt-1 flex items-center gap-1">Acessar Sistema <i data-lucide="arrow-right" class="w-3 h-3"></i></p></div>
                        </div>
                    </a>
                </div>
            </section>
        </div>
        <footer class="mt-20 text-center text-[10px] text-slate-400/60 font-mono tracking-widest uppercase">Benai OS v3.5 • Central</footer>
    </div>

    <!-- SETTINGS MODAL (CENTERED & UPDATED) -->
    <div id="settingsModal" class="fixed inset-0 z-50 bg-slate-900/50 dark:bg-black/80 backdrop-blur-sm hidden flex items-center justify-center p-4" onclick="if(event.target === this) closeSettings()">
        <div class="bg-white dark:bg-[#0f172a] w-full max-w-md rounded-3xl p-6 shadow-2xl border border-slate-200 dark:border-slate-800 modal-enter relative">
            <div class="flex justify-between items-center mb-6 border-b border-slate-100 dark:border-slate-800 pb-4">
                <h2 class="text-xl font-bold font-sans dark:text-white flex items-center gap-2"><i data-lucide="settings" class="text-orange-500"></i> Configurações</h2>
                <button onclick="closeSettings()" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full dark:text-white"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            
            <div class="space-y-6 max-h-[70vh] overflow-y-auto pr-2 custom-scrollbar">
                
                <!-- GESTÃO DE USUÁRIOS (CREDENCIAIS) -->
                <div id="user-management" class="hidden">
                    <div class="p-5 bg-sky-50 dark:bg-sky-900/10 rounded-2xl border border-sky-200 dark:border-sky-800">
                        <h3 class="text-sm font-bold flex items-center gap-2 mb-4 text-sky-800 dark:text-sky-400"><i data-lucide="users" class="w-4 h-4"></i> Gestão de Usuários</h3>
                        
                        <div class="space-y-4 mb-6">
                            <div>
                                <label class="text-[10px] font-bold uppercase text-slate-500 dark:text-slate-400 block mb-1">Seu PIN Mestre</label>
                                <div class="flex gap-2 relative">
                                    <input type="password" id="adminPinInput" class="w-full bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-lg p-2 text-xs font-mono pr-8" placeholder="PIN Atual">
                                    <button onclick="togglePass('adminPinInput')" class="absolute right-14 top-2 text-slate-400 hover:text-sky-500"><i data-lucide="eye" class="w-4 h-4"></i></button>
                                    <button onclick="updateCredential('ADMIN_PIN', 'adminPinInput')" class="bg-sky-500 text-white px-3 rounded-lg text-[10px] font-bold hover:bg-sky-600">SALVAR</button>
                                </div>
                            </div>
                            
                            <div class="h-px bg-slate-200 dark:bg-slate-700"></div>

                            <div>
                                <label class="text-[10px] font-bold uppercase text-slate-500 dark:text-slate-400 block mb-1">Usuário Convidado (Nome)</label>
                                <div class="flex gap-2">
                                    <input type="text" id="guestUserInput" class="w-full bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-lg p-2 text-xs font-mono uppercase" placeholder="Padrão: TALITA">
                                    <button onclick="updateCredential('GUEST_USER', 'guestUserInput')" class="bg-orange-500 text-white px-3 rounded-lg text-[10px] font-bold hover:bg-orange-600">SALVAR</button>
                                </div>
                            </div>
                            <div>
                                <label class="text-[10px] font-bold uppercase text-slate-500 dark:text-slate-400 block mb-1">Senha Convidado</label>
                                <div class="flex gap-2 relative">
                                    <input type="password" id="guestPassInput" class="w-full bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-lg p-2 text-xs font-mono pr-8" placeholder="Senha Atual">
                                    <button onclick="togglePass('guestPassInput')" class="absolute right-14 top-2 text-slate-400 hover:text-orange-500"><i data-lucide="eye" class="w-4 h-4"></i></button>
                                    <button onclick="updateCredential('GUEST_PASS', 'guestPassInput')" class="bg-orange-500 text-white px-3 rounded-lg text-[10px] font-bold hover:bg-orange-600">SALVAR</button>
                                </div>
                            </div>
                        </div>

                        <div class="border-t border-sky-200 dark:border-sky-800 pt-4">
                            <p class="text-[10px] font-bold text-slate-500 dark:text-slate-400 mb-3 uppercase">Permissões de Visualização (Convidado)</p>
                            <div class="space-y-3">
                                <label class="flex items-center justify-between cursor-pointer"><span class="text-xs font-bold text-slate-600 dark:text-slate-300">Financeiro</span><div class="relative inline-block w-10 align-middle select-none"><input type="checkbox" id="perm-btn-finance" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-300"/><label for="perm-btn-finance" class="toggle-label block overflow-hidden h-5 rounded-full bg-slate-300 cursor-pointer"></label></div></label>
                                <!-- Renamed from Cartão C6 to Cartão -->
                                <label class="flex items-center justify-between cursor-pointer"><span class="text-xs font-bold text-slate-600 dark:text-slate-300">Cartão</span><div class="relative inline-block w-10 align-middle select-none"><input type="checkbox" id="perm-btn-card" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-300"/><label for="perm-btn-card" class="toggle-label block overflow-hidden h-5 rounded-full bg-slate-300 cursor-pointer"></label></div></label>
                                <label class="flex items-center justify-between cursor-pointer"><span class="text-xs font-bold text-slate-600 dark:text-slate-300">Dieta</span><div class="relative inline-block w-10 align-middle select-none"><input type="checkbox" id="perm-btn-diet" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-300"/><label for="perm-btn-diet" class="toggle-label block overflow-hidden h-5 rounded-full bg-slate-300 cursor-pointer"></label></div></label>
                                <label class="flex items-center justify-between cursor-pointer"><span class="text-xs font-bold text-slate-600 dark:text-slate-300">Viagens</span><div class="relative inline-block w-10 align-middle select-none"><input type="checkbox" id="perm-btn-travel" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-300"/><label for="perm-btn-travel" class="toggle-label block overflow-hidden h-5 rounded-full bg-slate-300 cursor-pointer"></label></div></label>
                            </div>
                            <button onclick="saveGuestPermissions()" class="mt-4 w-full py-2 text-xs font-bold text-sky-600 bg-white border border-sky-200 rounded-lg hover:bg-sky-50 transition shadow-sm">ATUALIZAR PERMISSÕES</button>
                        </div>
                    </div>
                </div>
                
                <!-- Token Block -->
                <div>
                    <label class="block text-xs font-bold uppercase text-slate-400 mb-2 tracking-wider">GitHub Token (Global)</label>
                    <div class="relative"><input type="password" id="globalToken" class="w-full bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl p-3 pl-10 text-xs font-mono focus:ring-2 focus:ring-orange-500 outline-none dark:text-white" placeholder="ghp_..."><div class="absolute left-3 top-3"><i data-lucide="key" class="w-4 h-4 text-slate-400"></i></div></div>
                    <button onclick="saveToken()" class="mt-2 w-full py-2 text-xs font-bold text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-900/20 rounded-lg hover:bg-orange-100 dark:hover:bg-orange-900/40 transition">SALVAR TOKEN</button>
                </div>

                <!-- Global Backup -->
                <div class="p-5 bg-slate-50 dark:bg-slate-800/50 rounded-2xl border border-slate-200 dark:border-slate-700">
                    <h3 class="text-sm font-bold flex items-center gap-2 mb-2 dark:text-white"><i data-lucide="cloud" class="w-4 h-4 text-sky-500"></i> Backup Global</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="cloudBackupAll()" class="flex flex-col items-center justify-center gap-1 py-3 bg-sky-600 text-white rounded-xl font-bold text-[10px] hover:bg-sky-700 transition"><i data-lucide="upload-cloud" class="w-4 h-4"></i> ENVIAR</button>
                        <button onclick="cloudRestoreAll()" class="flex flex-col items-center justify-center gap-1 py-3 bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 dark:text-white rounded-xl font-bold text-[10px] hover:bg-slate-50 transition"><i data-lucide="download-cloud" class="w-4 h-4"></i> BAIXAR</button>
                    </div>
                </div>

                <div class="pt-4 border-t border-slate-100 dark:border-slate-800">
                    <button onclick="if(confirm('Sair?')){sessionStorage.clear(); location.reload()}" class="w-full py-3 border border-red-200 dark:border-red-900/30 text-red-500 rounded-xl font-bold text-xs hover:bg-red-50 dark:hover:bg-red-900/10 transition flex items-center justify-center gap-2"><i data-lucide="lock" class="w-3 h-3"></i> BLOQUEAR TERMINAL</button>
                </div>
            </div>
        </div>
    </div>

    <!-- GATEKEEPER CONFIG MODAL (INITIAL) -->
    <div id="gk-config-modal" class="fixed inset-0 z-[10001] bg-slate-900/90 backdrop-blur-md hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-[#0f172a] w-full max-w-sm rounded-3xl p-6 shadow-2xl text-center">
            <h3 class="font-bold text-lg mb-2 dark:text-white">Configuração Inicial</h3>
            <p class="text-xs text-slate-500 mb-4">Configure o token antes de logar para restaurar dados.</p>
            <input type="password" id="gk-token" class="w-full bg-slate-100 dark:bg-slate-800 p-3 rounded-xl text-center text-xs mb-4 outline-none border border-transparent focus:border-orange-500 dark:text-white" placeholder="GitHub Token Global">
            <button onclick="saveTokenFromGatekeeper()" class="w-full py-3 bg-sky-500 text-white rounded-xl font-bold text-sm shadow-lg hover:bg-sky-600 transition">SALVAR TOKEN</button>
            <button onclick="document.getElementById('gk-config-modal').classList.add('hidden')" class="mt-4 text-xs font-bold text-slate-400 hover:text-slate-600">FECHAR</button>
        </div>
    </div>

    <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-slate-900 dark:bg-white text-white dark:text-slate-900 px-6 py-3 rounded-full font-bold shadow-2xl translate-y-20 opacity-0 transition-all duration-300 z-[100] flex items-center gap-3 whitespace-nowrap border border-white/10">
        <i data-lucide="info" class="w-4 h-4 text-orange-400"></i><span id="toastMsg" class="text-xs">Notificação</span>
    </div>

    <!-- APP FRAME WRAPPER -->
    <div id="app-frame-container">
        <iframe id="os-frame" src="about:blank"></iframe>
    </div>

    <!-- TEMPLATES -->
    <template id="tpl-finance"><style>body{margin:0;overflow:hidden;height:100vh;}</style><iframe src="financeiro.html" style="width:100%;height:100%;border:none;"></iframe></template>
    <template id="tpl-prime"><style>body{margin:0;overflow:hidden;height:100vh;}</style><iframe src="prime.html" style="width:100%;height:100%;border:none;"></iframe></template>
    <template id="tpl-card"><style>body{margin:0;overflow:hidden;height:100vh;}</style><iframe src="card.html" style="width:100%;height:100%;border:none;"></iframe></template>
    <template id="tpl-diet"><style>body{margin:0;overflow:hidden;height:100vh;}</style><iframe src="dieta.html" style="width:100%;height:100%;border:none;"></iframe></template>
    <template id="tpl-travel"><style>body{margin:0;overflow:hidden;height:100vh;}</style><iframe src="viagens.html" style="width:100%;height:100%;border:none;"></iframe></template>
    <template id="tpl-generator"><style>body{margin:0;overflow:hidden;height:100vh;}</style><iframe src="gerador.html" style="width:100%;height:100%;border:none;"></iframe></template>

    <script>
        // DEFAULT CREDENTIALS
        const DEFAULT_MASTER = "16359001";
        const DEFAULT_GUEST_USER = "TALITA";
        const DEFAULT_GUEST_PASS = "Melissa0107";
        
        const TOKEN_KEY = "BENAI_GLOBAL_TOKEN";
        const PERMS_KEY = "BENAI_GUEST_PERMS";
        const GIST_DESC_GLOBAL = "BENAI_FULL_BACKUP_V3";
        const DEFAULT_PERMS = { 'btn-finance': false, 'btn-card': true, 'btn-diet': false, 'btn-travel': true, 'sec-consultoria': false, 'sec-trabalho': false };

        // --- LAUNCHER LOGIC ---
        window.launchApp = function(appName) {
            const frame = document.getElementById('os-frame');
            const container = document.getElementById('app-frame-container');
            let tplId = 'tpl-' + appName;
            const tpl = document.getElementById(tplId);
            if(tpl) {
                frame.srcdoc = tpl.innerHTML;
                container.classList.add('open');
            }
        };

        window.closeApp = function() {
            document.getElementById('app-frame-container').classList.remove('open');
            setTimeout(() => { document.getElementById('os-frame').srcdoc = 'about:blank'; }, 500);
        };

        // --- AUTH & INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            checkGatekeeper();
            updateDate();
            lucide.createIcons();
            const t = localStorage.getItem(TOKEN_KEY);
            if(t) {
                document.getElementById('syncIndicator').classList.replace('bg-red-500', 'bg-emerald-500');
                document.getElementById('globalToken').value = t;
                document.getElementById('gk-token').value = t;
            }
        });

        function checkGatekeeper() {
            if(sessionStorage.getItem('benai_auth') === 'true') unlockUI();
            else document.getElementById('userInput').focus();
        }

        function attemptLogin() {
            const u = document.getElementById('userInput').value.toUpperCase().trim();
            const p = document.getElementById('passInput').value.trim();
            const err = document.getElementById('pinError');

            // Get credentials from LocalStorage or Defaults
            const adminPin = localStorage.getItem('BENAI_ADMIN_PIN') || DEFAULT_MASTER;
            const guestUser = localStorage.getItem('BENAI_GUEST_USER') || DEFAULT_GUEST_USER;
            const guestPass = localStorage.getItem('BENAI_GUEST_PASS') || DEFAULT_GUEST_PASS;

            if (p === adminPin) {
                sessionStorage.setItem('benai_auth', 'true');
                sessionStorage.setItem('benai_role', 'admin');
                unlockUI();
            } else if (u === guestUser && p === guestPass) {
                sessionStorage.setItem('benai_auth', 'true');
                sessionStorage.setItem('benai_role', 'guest');
                unlockUI();
            } else {
                err.style.opacity = '1';
                document.getElementById('passInput').value = '';
                setTimeout(() => err.style.opacity = '0', 2000);
            }
        }

        function unlockUI() {
            document.getElementById('gatekeeper').style.opacity = '0';
            document.getElementById('gatekeeper').style.pointerEvents = 'none';
            applyAccessControl();
            setTimeout(() => document.getElementById('app-container').style.opacity = '1', 500);
        }

        function applyAccessControl() {
            const role = sessionStorage.getItem('benai_role');
            if (role === 'guest') {
                document.getElementById('btn-settings').style.display = 'none';
                const saved = localStorage.getItem(PERMS_KEY);
                const perms = saved ? JSON.parse(saved) : DEFAULT_PERMS;
                Object.keys(perms).forEach(id => {
                    const el = document.getElementById(id);
                    if(el) el.style.display = perms[id] ? '' : 'none';
                });
            } else {
                document.getElementById('user-management').classList.remove('hidden');
                
                // Load saved credential values into inputs for editing
                document.getElementById('adminPinInput').value = localStorage.getItem('BENAI_ADMIN_PIN') || DEFAULT_MASTER;
                document.getElementById('guestUserInput').value = localStorage.getItem('BENAI_GUEST_USER') || DEFAULT_GUEST_USER;
                document.getElementById('guestPassInput').value = localStorage.getItem('BENAI_GUEST_PASS') || DEFAULT_GUEST_PASS;

                loadAdminCheckboxes();
                Object.keys(DEFAULT_PERMS).forEach(id => {
                    const el = document.getElementById(id);
                    if(el) el.style.display = '';
                });
            }
        }

        // --- CREDENTIAL MANAGEMENT ---
        function updateCredential(key, inputId) {
            const val = document.getElementById(inputId).value.trim();
            if(key.includes('USER')) {
                if(val.length < 3) return alert("Usuário muito curto");
                localStorage.setItem('BENAI_' + key, val.toUpperCase());
            } else {
                if(val.length < 3) return alert("Senha muito curta");
                localStorage.setItem('BENAI_' + key, val);
            }
            showToast('Atualizado!');
        }

        function togglePass(id) {
            const inp = document.getElementById(id);
            if(inp.type === 'password') inp.type = 'text';
            else inp.type = 'password';
        }

        function loadAdminCheckboxes() {
            const saved = localStorage.getItem(PERMS_KEY);
            const perms = saved ? JSON.parse(saved) : DEFAULT_PERMS;
            Object.keys(perms).forEach(id => {
                const cb = document.getElementById('perm-' + id);
                if(cb) cb.checked = perms[id];
            });
        }

        function saveGuestPermissions() {
            const perms = {};
            Object.keys(DEFAULT_PERMS).forEach(id => {
                const cb = document.getElementById('perm-' + id);
                if(cb) perms[id] = cb.checked;
            });
            localStorage.setItem(PERMS_KEY, JSON.stringify(perms));
            showToast('Permissões de Visitante Atualizadas!');
        }

        // --- CLOUD SYNC GLOBAL ---
        function openGatekeeperConfig() { document.getElementById('gk-config-modal').classList.remove('hidden'); }
        function saveTokenFromGatekeeper() {
            const t = document.getElementById('gk-token').value.trim();
            if(t) {
                localStorage.setItem(TOKEN_KEY, t);
                document.getElementById('globalToken').value = t;
                showToast('Token Global Salvo!');
                document.getElementById('gk-config-modal').classList.add('hidden');
            }
        }

        function saveToken() {
            const val = document.getElementById('globalToken').value.trim();
            if(val) {
                localStorage.setItem(TOKEN_KEY, val);
                document.getElementById('syncIndicator').classList.replace('bg-red-500', 'bg-emerald-500');
                showToast('Token Global Salvo!');
            }
        }

        async function cloudBackupAll() {
            const token = localStorage.getItem(TOKEN_KEY);
            if(!token) return showToast('Configure o Token primeiro!');
            showToast('Iniciando Backup Global...');

            const backupData = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                backupData[key] = localStorage.getItem(key);
            }

            try {
                // 1. Check if Gist exists
                const gists = await fetch('https://api.github.com/gists', { headers: { 'Authorization': `token ${token}` } }).then(r => r.json());
                const existing = gists.find(g => g.description === GIST_DESC_GLOBAL);
                
                const payload = {
                    description: GIST_DESC_GLOBAL,
                    public: false,
                    files: { "benai_full_backup.json": { content: JSON.stringify(backupData) } }
                };

                let url = 'https://api.github.com/gists';
                let method = 'POST';

                if(existing) {
                    url += '/' + existing.id;
                    method = 'PATCH';
                }

                const res = await fetch(url, {
                    method: method,
                    headers: { 'Authorization': `token ${token}` },
                    body: JSON.stringify(payload)
                });

                if(res.ok) showToast('Backup Global Concluído!');
                else throw new Error('Falha na API');

            } catch(e) { console.error(e); showToast('Erro ao salvar na nuvem'); }
        }

        async function cloudRestoreAll() {
            const token = localStorage.getItem(TOKEN_KEY);
            if(!token) return showToast('Configure o Token primeiro!');
            if(!confirm('Isso substituirá TODOS os dados locais pelos da nuvem. Continuar?')) return;

            showToast('Buscando dados...');
            try {
                const gists = await fetch('https://api.github.com/gists', { headers: { 'Authorization': `token ${token}` } }).then(r => r.json());
                const backupGist = gists.find(g => g.description === GIST_DESC_GLOBAL);
                if(!backupGist) return showToast('Nenhum backup encontrado.');

                const fileUrl = backupGist.files['benai_full_backup.json'].raw_url;
                const data = await fetch(fileUrl).then(r => r.json());

                Object.keys(data).forEach(key => localStorage.setItem(key, data[key]));
                showToast('Sistema Restaurado! Recarregando...');
                setTimeout(() => location.reload(), 1500);
            } catch(e) { console.error(e); showToast('Erro ao restaurar'); }
        }

        // --- UTILS ---
        function initTheme() {
            if (localStorage.getItem('theme') === 'light') {
                document.documentElement.classList.remove('dark');
                document.getElementById('themeIcon').setAttribute('data-lucide', 'sun');
            }
        }
        function toggleTheme() {
            const html = document.documentElement;
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
                document.getElementById('themeIcon').setAttribute('data-lucide', 'sun');
            } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
                document.getElementById('themeIcon').setAttribute('data-lucide', 'moon');
            }
            lucide.createIcons();
        }
        function updateDate() {
            const now = new Date();
            const options = { weekday: 'long', day: 'numeric', month: 'long' };
            document.getElementById('dateDisplay').innerText = now.toLocaleDateString('pt-BR', options);
        }
        function openSettings() {
            if(sessionStorage.getItem('benai_role') === 'admin') {
                loadAdminCheckboxes();
                // Load values into inputs when opening
                document.getElementById('adminPinInput').value = localStorage.getItem('BENAI_ADMIN_PIN') || DEFAULT_MASTER;
                document.getElementById('guestUserInput').value = localStorage.getItem('BENAI_GUEST_USER') || DEFAULT_GUEST_USER;
                document.getElementById('guestPassInput').value = localStorage.getItem('BENAI_GUEST_PASS') || DEFAULT_GUEST_PASS;
            }
            document.getElementById('settingsModal').classList.remove('hidden');
        }
        function closeSettings() {
            document.getElementById('settingsModal').classList.add('hidden');
        }
        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = msg;
            t.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => t.classList.add('translate-y-20', 'opacity-0'), 3000);
        }
    </script>
</body>
</html>
